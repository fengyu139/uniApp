import{o as e,c as t,w as a,a as l,n as s,h as u,f as n,i,g as o,X as r,y as c,b as d,q as p,F as m,d as f,B as y,t as v,j as x,D as h,_ as b,z as g,p as k,u as _,k as C,au as V,v as D,C as w,Z as q,av as S,a5 as N,s as j,aw as B}from"./index-252a0b36.js";import{_ as F}from"./uni-easyinput.e36f5bfe.js";import{_ as O,r as I,q as E,e as $,f as J,t as L,v as M,j as U,o as A,m as T,c as z,b as H}from"./api.5dfc4364.js";import{a as R,_ as P,b as X}from"./uni-popup.41edc112.js";import{i as Y}from"./imgErr.8cf36142.js";import{_ as Z}from"./abEmpty.dc2aa413.js";import{d as G}from"./dayjs.min.fc82c652.js";import{_ as K}from"./abMiniButton.b33ebfaf.js";import{_ as Q}from"./addRecords.381a5069.js";import{A as W}from"./abRadio.f5dc2a19.js";import{s as ee}from"./globalStore.3362f088.js";const te=O({name:"UniNumberBox",emits:["change","input","update:modelValue","blur","focus"],props:{value:{type:[Number,String],default:1},modelValue:{type:[Number,String],default:1},min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1},background:{type:String,default:"#f5f5f5"},color:{type:String,default:"#333"},disabled:{type:Boolean,default:!1}},data:()=>({inputValue:0}),watch:{value(e){this.inputValue=+e},modelValue(e){this.inputValue=+e}},created(){1===this.value&&(this.inputValue=+this.modelValue),1===this.modelValue&&(this.inputValue=+this.value)},methods:{_calcValue(e){if(this.disabled)return;const t=this._getDecimalScale();let a=this.inputValue*t,l=this.step*t;if("minus"===e){if(a-=l,a<this.min*t)return;a>this.max*t&&(a=this.max*t)}if("plus"===e){if(a+=l,a>this.max*t)return;a<this.min*t&&(a=this.min*t)}this.inputValue=(a/t).toFixed(String(t).length-1),this.$emit("input",+this.inputValue),this.$emit("update:modelValue",+this.inputValue),this.$emit("change",+this.inputValue)},_getDecimalScale(){let e=1;return~~this.step!==this.step&&(e=Math.pow(10,String(this.step).split(".")[1].length)),e},_onBlur(e){this.$emit("blur",e);let t=e.detail.value;if(isNaN(t))return void(this.inputValue=this.min);t=+t,t>this.max?t=this.max:t<this.min&&(t=this.min);const a=this._getDecimalScale();this.inputValue=t.toFixed(String(a).length-1),this.$emit("input",+this.inputValue),this.$emit("update:modelValue",+this.inputValue),this.$emit("change",+this.inputValue)},_onFocus(e){this.$emit("focus",e)}}},[["render",function(c,d,p,m,f,y){const v=i,x=o,h=r;return e(),t(x,{class:"uni-numbox"},{default:a((()=>[l(x,{onClick:d[0]||(d[0]=e=>y._calcValue("minus")),class:"uni-numbox__minus uni-numbox-btns",style:s({background:p.background})},{default:a((()=>[l(v,{class:u(["uni-numbox--text",{"uni-numbox--disabled":f.inputValue<=p.min||p.disabled}]),style:s({color:p.color})},{default:a((()=>[n("-")])),_:1},8,["class","style"])])),_:1},8,["style"]),l(h,{disabled:p.disabled,onFocus:y._onFocus,onBlur:y._onBlur,class:"uni-numbox__value",type:"number",modelValue:f.inputValue,"onUpdate:modelValue":d[1]||(d[1]=e=>f.inputValue=e),style:s({background:p.background,color:p.color})},null,8,["disabled","onFocus","onBlur","modelValue","style"]),l(x,{onClick:d[2]||(d[2]=e=>y._calcValue("plus")),class:"uni-numbox__plus uni-numbox-btns",style:s({background:p.background})},{default:a((()=>[l(v,{class:u(["uni-numbox--text",{"uni-numbox--disabled":f.inputValue>=p.max||p.disabled}]),style:s({color:p.color})},{default:a((()=>[n("+")])),_:1},8,["class","style"])])),_:1},8,["style"])])),_:1})}],["__scopeId","data-v-2cc6f69d"]]),ae={__name:"abMenuList",props:{list:{type:Array,default:()=>[]},disabledBtn:{type:Boolean,default:!1}},setup:a=>(s,u)=>{const n=b,i=I(c("uni-number-box"),te);return e(),d(m,null,[p("ul",{class:"w-full"},[(e(!0),d(m,null,f(a.list,((t,s)=>(e(),d("li",{key:s,class:"flex p-[8px] mb-[12px] w-full mx-[12px] items-center",style:{"border-bottom":"1px solid var(--border_c)"}},[l(n,{src:t.picImg||y(Y),onError:e=>(e=>{e.picImg=Y})(t),onClick:e=>{var a;(a=t.picImg).includes("imgErr")||h({urls:[a]})},class:"w-[60px] h-[60px]"},null,8,["src","onError","onClick"]),p("div",{class:"ml-[10px]"},[p("p",null,v(t.name),1),p("p",null,[p("span",{class:"text-text3"},v(t.price.toFixed(2)),1),p("span",{class:"text-text2 text-12"},"/"+v(t.unit),1)]),l(i,{modelValue:t.count,"onUpdate:modelValue":e=>t.count=e,min:0,disabled:a.disabledBtn},null,8,["modelValue","onUpdate:modelValue","disabled"])])])))),128))]),a.list.length?x("",!0):(e(),t(Z,{key:0,text:"暂无数据"}))],64)}},le={__name:"orderBottom",props:{list:{type:Array,default:()=>[]},isChange:{type:Boolean,default:!1},queryData:{type:Object,default:()=>{}},allList:{type:Array,default:()=>[]},backupData:{type:Array,default:()=>[]}},emits:["clear","updateClone","initOrder","setCloneData"],setup(s,{emit:u}){const i=s,r=V("btnStutas"),h=V("socket"),b=g((()=>{let e=i.list.reduce(((e,t)=>e+t.price*t.count),0);return parseFloat(e.toFixed(2))})),N=g((()=>i.list.reduce(((e,t)=>e+t.count),0))),j=async()=>{if(i.isChange){if(i.queryData.id){let e=[];i.list.forEach((t=>{const a=i.backupData.find((e=>e.id==t.id));if(t.count!=a.count){let l=JSON.parse(JSON.stringify(t));l.count=t.count-a.count,l.count>0&&e.push(l)}})),await $({id:i.queryData.id,orderDetail:i.list,totalMoney:b.value,totalCount:N.value,recordsList:e.length?e:"",isAdmin:!0}),u("setCloneData")}else{let e=G().format("HH:mm"),t=await J({orderName:e+"-"+i.queryData.desk+"号桌",isPack:!1,taste:Number(z.value),isFinish:!1,totalCount:N.value,totalMoney:b.value,orderDetail:i.list,actualMoney:0,desk:Number(i.queryData.desk)||"",userOperation:!0},!0);console.log(t),C()||(r.value=!0),i.queryData.id=t.data,h.emit("message",{desk:i.queryData.desk,type:"submitted",orderId:t.data}),t.orderFlag&&(w("orderId",t.data),q({url:"/pages/orderDetail/orderInfo"})),T.value.close()}u("updateClone"),D({icon:"success",title:"已提交"})}else D({title:"没有更改，无需提交",icon:"none"})},B=k(null),F=k([]),O=async()=>{let e=await L({orderId:i.queryData.id||"234wert"});F.value=e,B.value.open()};E((()=>{i.isChange&&_({title:"提示",content:"订单未保存，是否保存",success:async({confirm:e,cancel:t})=>!e||(await j(),!0)})}));const A=()=>{_({title:"提示",content:"确定要清空所有选项吗",showCancel:!0,success:({confirm:e,cancel:t})=>{e&&(u("clear"),D({icon:"success"}))}})},T=k(null),z=k("1"),H=async()=>{j()};let X=[];const Y=k(!1),ee=()=>{D({title:"已重置菜单，请选择您要添加的菜品",icon:"none",mask:!1}),X=JSON.parse(JSON.stringify(i.allList)),r.value=!1,Y.value=!0,u("clear")},te=async()=>{let e=i.list.filter((e=>e.count>0));await M({orderId:i.queryData.id,desk:i.queryData.desk,items:e,totalMoney:b.value,totalCount:N.value});let t="";e.forEach((e=>{t+=` ${e.name}  x ${e.count} \n`})),h.emit("message",{msg:t,desk:i.queryData.desk,type:"addFoods",orderId:i.queryData.id}),_({title:"提示",content:"提交成功，等待上菜吧",confirmText:"知道了",showCancel:!1}),r.value=!0,Y.value=!1,u("initOrder")},ae=()=>{_({title:"提示",content:"是否放弃本次加菜",showCancel:!0,success:({confirm:e,cancel:t})=>{e&&(r.value=!0,Y.value=!1,u("updateClone",X))}})},le=k(1),se=async()=>{_({title:"设置桌号",content:le.value,editable:!0,placeholderText:"请输入桌号",showCancel:!0,success:async({confirm:e,cancel:t,content:a})=>{e&&(await $({id:i.queryData.id,desk:Number(a)}),D({title:"成功",icon:"success",mask:!0}))}})};return h.on("message",(e=>{if(i.queryData.desk&&i.queryData.desk==e.desk){if("submitted"==e.type)return void _({title:"提示",content:"您的同桌已经提交了订单",showCancel:!1,confirmText:"知道了",success:()=>{u("initOrder")}});C()||_({title:"来自您同桌的加菜",content:e.msg,showCancel:!1,confirmText:"知道了",success:()=>{u("initOrder")}})}})),(u,i)=>{const h=I(c("uni-icons"),U),g=o,k=S,_=I(c("uni-popup"),R),V=I(c("uni-popup-dialog"),P);return e(),d("div",null,[p("div",{class:"h-[40px] flex items-center px-[10px]"},[p("span",{class:"flex items-center text-text3 text-16 font-bold"},[l(h,{type:"cart",color:"",size:"24",class:"mr-[2px]"}),n(" "+v(y(b).toFixed(2)),1)]),l(g,{class:"ml-auto mr-[10px]"},{default:a((()=>[l(K,{type:"warn",onClick:A,icon:"close"},{default:a((()=>[n("清空")])),_:1})])),_:1}),y(C)()?(e(),t(g,{key:0,class:"mr-[10px]"},{default:a((()=>[l(K,{onClick:se},{default:a((()=>[n("设置桌号")])),_:1})])),_:1})):x("",!0),l(g,{class:"mr-[10px]"},{default:a((()=>[l(K,{onClick:O},{default:a((()=>[n("查看明细")])),_:1})])),_:1}),s.queryData.desk&&y(r)?(e(),t(g,{key:1,class:"mr-[10px]"},{default:a((()=>[l(K,{onClick:ee},{default:a((()=>[n("我要加菜")])),_:1})])),_:1})):x("",!0),!y(r)&&Y.value?(e(),t(g,{key:2,class:"mr-[10px]"},{default:a((()=>[l(K,{onClick:ae},{default:a((()=>[n("取消")])),_:1})])),_:1})):x("",!0),y(r)||!Y.value||s.list.every((e=>0==e.count))?x("",!0):(e(),t(g,{key:3,class:"mr-[10px]"},{default:a((()=>[l(K,{type:"warn",icon:"plusempty",onClick:te},{default:a((()=>[n("选好了")])),_:1})])),_:1})),s.queryData.id&&!s.queryData.desk?(e(),t(g,{key:4,class:""},{default:a((()=>[l(K,{type:"warn",onClick:j},{default:a((()=>[n("提交")])),_:1})])),_:1})):x("",!0),s.queryData.id?x("",!0):(e(),t(g,{key:5,class:""},{default:a((()=>[l(K,{type:"warn",onClick:i[0]||(i[0]=e=>T.value.open())},{default:a((()=>[n("提交")])),_:1})])),_:1}))]),l(_,{ref_key:"popupOne",ref:B,type:"bottom"},{default:a((()=>[l(g,{class:"bg-bg3 p-[12px]"},{default:a((()=>[p("div",{class:"flex justify-center items-center px-[10px]"},[p("span",{class:"text-16 font-bold text-text2 ml-auto"},"订单汇总"),l(h,{class:"ml-auto",type:"closeempty",onClick:i[1]||(i[1]=e=>B.value.close()),color:"#ccc",size:"24"})]),l(k,{"scroll-y":"true",style:{"max-height":"80vh"}},{default:a((()=>[s.list.length?(e(),d("div",{key:0},[p("ul",null,[p("li",{class:"grid grid-cols-4 text-center py-[4px] font-bold"},[p("span",null,"名称"),p("span",null,"单价"),p("span",null,"数量"),p("span",null,"小记")]),(e(!0),d(m,null,f(s.list,(t=>(e(),d("li",{key:t.id,class:"grid grid-cols-4 text-center py-[4px]",style:{"border-bottom":"1px solid var(--border_c)"}},[p("span",null,v(t.name),1),p("span",null,v(t.price.toFixed(2)),1),p("span",null,v(t.count),1),p("span",{class:"text-text3"},v((t.price*t.count).toFixed(2)),1)])))),128))]),p("div",{class:"mt-[12px] flex justify-center"},[p("span",{class:"text-text3 font-bold mr-[10px]"},"总数量:"+v(y(N)),1),p("span",{class:"text-text3 font-bold"},"总计:"+v(y(b)),1)])])):(e(),t(Z,{key:1,text:"暂无数据"})),F.value.length>1?(e(),t(Q,{key:2,recordsList:F.value},null,8,["recordsList"])):x("",!0)])),_:1})])),_:1})])),_:1},512),l(_,{ref_key:"popupTwo",ref:T,type:"dialog"},{default:a((()=>[l(V,{title:"添加订单",duration:2e3,"before-close":!0,onClose:i[3]||(i[3]=e=>T.value.close()),onConfirm:H},{default:a((()=>[p("div",{class:"w-full"},[l(W,{modelValue:z.value,"onUpdate:modelValue":i[2]||(i[2]=e=>z.value=e),list:[{label:"正常辣",value:"1"},{label:"微辣",value:"2"},{label:"特辣",value:"3"}]},null,8,["modelValue"])])])),_:1})])),_:1},512)])}}},se=O({__name:"index",setup(i){const o=k([]),r=k({}),h=k(""),b=k(1),_=k(0);let C=k([]);const V=k({});A((async e=>{V.value=e;let t="欢迎点餐";(e.name||e.desk)&&(t=e.name||e.desk+"号桌"),N({title:t}),q()}));const D=k(!1);B("btnStutas",D);const w=g((()=>{var e;return(null==(e=r.value)?void 0:e.isFinish)||V.value.desk&&D.value})),q=async()=>{let e=await T({filter:!0});o.value=e,o.value.forEach((e=>{e.count=0})),C.value=o.value.map((e=>e.count));let t={};if(V.value.id?t={id:V.value.id}:V.value.desk&&(t={desk:V.value.desk,isFinish:!1}),Object.keys(t).length){let e=await z(t);if(!e.length)return;r.value=e[0],r.value.desk==V.value.desk&&(D.value=!0),V.value.id=r.value.id,o.value.forEach((e=>{e.count=0,r.value.orderDetail.forEach((t=>{e.id==t.id&&(e.count=t.count)}))})),C.value=o.value.map((e=>e.count)),E()}},O=k([]),E=()=>{O.value=JSON.parse(JSON.stringify(o.value))};H((async()=>{await q(),j()}));const $=g((()=>o.value.filter((e=>e.count)))),J=g((()=>JSON.stringify(C.value)!=JSON.stringify(o.value.map((e=>e.count))))),L=g((()=>{let e={};return ee.value.forEach((t=>{e[t.value]=o.value.filter((e=>e.type==t.value&&e.count)).reduce(((e,t)=>e+t.count),0)})),e})),M=()=>{o.value.forEach((e=>{e.count=0}))},U=e=>{console.log(e),e&&(o.value=e),C.value=o.value.map((e=>e.count))},P=()=>{Y.value.open()},Y=k(null);return(i,r)=>{const g=I(c("uni-easyinput"),F),k=I(c("uni-transition"),X),C=S,D=I(c("uni-popup"),R);return e(),d(m,null,[p("div",{class:"p-[12px]"},[l(g,{clearable:"",prefixIcon:"search",confirmType:"搜索",modelValue:h.value,"onUpdate:modelValue":r[0]||(r[0]=e=>h.value=e),onBlur:P,placeholder:"请输入关键字"},null,8,["modelValue"])]),p("div",{class:"flex",style:{height:"calc(100% - 98px)"}},[p("div",{class:"h-full bg-bg1 w-1/3"},[p("ul",{class:"text-text2"},[(e(!0),d(m,null,f(y(ee),((t,a)=>(e(),d("li",{class:u(["text-center py-[8px] my-[4px] relative",{active:t.value==b.value}]),key:a,onClick:e=>{b.value=t.value,_.value=a}},[n(v(t.text)+" ",1),t.value==b.value?(e(),d("div",{key:0,class:"absolute left-[4px] top-[8px]"},[l(k,{"mode-class":"slide-bottom",styles:{width:"4px",height:"20px",backgroundColor:"red"},show:t.value==b.value,onChange:i.change},null,8,["show","onChange"])])):x("",!0),y(L)[t.value]?(e(),d("span",{key:1,class:"bg-bg2 text-text4 rounded-md text-12 px-[6px] absolute top-0 right-[2px] scale-[80%]"},v(y(L)[t.value]),1)):x("",!0)],10,["onClick"])))),128))])]),p("div",{class:"h-full overflow-hidden w-2/3"},[p("div",{class:"h-full scrollDom",style:s({transform:`translateY(-${100*_.value}%)`})},[(e(!0),d(m,null,f(y(ee),(s=>(e(),t(C,{"scroll-y":"true",class:"h-full",key:s.value},{default:a((()=>[l(ae,{list:o.value.filter((e=>e.type==s.value)),disabledBtn:y(w)},null,8,["list","disabledBtn"])])),_:2},1024)))),128))],4)])]),l(le,{list:y($),allList:o.value,backupData:O.value,isChange:y(J),queryData:V.value,onClear:M,onUpdateClone:U,onInitOrder:q,onSetCloneData:E},null,8,["list","allList","backupData","isChange","queryData"]),l(D,{ref_key:"popupOne",ref:Y,type:"bottom"},{default:a((()=>[p("div",{class:"p-[12px] bg-bg3"},[l(ae,{list:o.value.filter((e=>e.name.includes(h.value))),disabledBtn:y(w)},null,8,["list","disabledBtn"])])])),_:1},512)],64)}}},[["__scopeId","data-v-21f277e1"]]);export{se as default};
