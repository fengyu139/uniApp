import{p as a,m as e,C as s,s as t,$ as l,o as i,b as n,q as u,a as o,w as c,y as r,g as m,f as d,F as p,d as f,c as v,e as b,D as g,G as y,A as _,u as j,v as x,H as C,I as k}from"./index-ffdd3f87.js";import{_ as h}from"./uni-card.e3f11ce9.js";import{b as w,m as I,r as M,j as V}from"./api.39a99923.js";import{s as $}from"./globalStore.5443f323.js";import{_ as B}from"./abMiniButton.d5f2b05e.js";import{_ as D}from"./abButton.3cf189b9.js";import{_ as L}from"./abPicker.d85f9210.js";import{i as q}from"./imgErr.8cf36142.js";const A={__name:"manage",setup(A){const E=a(0),F=e([{text:"全部",value:0},...$.value]),G=a([]);s((async()=>{(async()=>{let a={};E.value&&(a.type=E.value);let e=await I(a);G.value=e,t()})()}));w((async()=>{E.value=0;let a=await I({type:E.value});G.value=a,t()}));const H=()=>{r({url:"/pages/manage/addMenu"})};l("changeMenu",(a=>{let e=G.value.findIndex((e=>e.id==a.id));e>-1&&(G.value[e]=a)}));return(a,e)=>{const s=m,t=M(_("uni-card"),h);return i(),n("div",{class:""},[u("div",{class:"p-[13px] flex justify-between items-center"},[o(L,{class:"w-3/5",modelValue:E.value,"onUpdate:modelValue":e[0]||(e[0]=a=>E.value=a),selectList:F,label:"选择分类"},null,8,["modelValue","selectList"]),o(D,{onClick:H,class:"w-1/3",icon:"plus"},{default:c((()=>[d("新增")])),_:1})]),o(s,null,{default:c((()=>[(i(!0),n(p,null,f(G.value,(a=>(i(),v(t,{title:a.name,thumbnail:a.picImg||g(q),"sub-title":F.find((e=>e.value==a.type)).text,extra:`价格：${a.price}`,onClick:e=>{return s=e,t=a.picImg,void("title"==s&&y({urls:[t],success:a=>{},fail:a=>{}}));var s,t}},{default:c((()=>[o(s,{class:"card-actions flex py-[6px] justify-around"},{default:c((()=>[o(B,{plain:"",onClick:b((e=>(a=>{C().globalData.menuItem=a,r({url:"/pages/manage/addMenu",success:e=>{setTimeout((()=>{k("menuItem",a)}),200)}})})(a)),["stop"])},{default:c((()=>[d("修改")])),_:2},1032,["onClick"]),o(B,{plain:"",type:"warn",icon:"trash",iconColor:"#fa2c19",onClick:b((e=>(async a=>{j({title:"提示",content:`确定删除${a.name}吗？`,showCancel:!0,success:({confirm:e,cancel:s})=>{e&&V({id:a.id}).then((e=>{x({title:"删除成功"}),G.value=G.value.filter((e=>e.id!=a.id))})).catch((a=>{x({title:"删除失败"+a})}))}})})(a)),["stop"])},{default:c((()=>[d("删除")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["title","thumbnail","sub-title","extra","onClick"])))),256))])),_:1})])}}};export{A as default};
