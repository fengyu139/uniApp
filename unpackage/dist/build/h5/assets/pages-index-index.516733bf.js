import{o as t,c as e,w as s,a,r as o,b as i,F as n,d as l,n as r,e as u,f as c,t as d,i as h,g as p,h as f,j as m,k as g,$ as y,l as v,m as x,p as b,s as w,q as _,u as k,v as S,x as C,y as T}from"./index-aada019a.js";import{_ as D}from"./uni-easyinput.e6e3be88.js";import{_ as Y,o as F,a as M,b as X,c as $,d as W,s as z,r as A,e as O,f as V}from"./api.28706665.js";import{a as j,_ as P}from"./adBell.0c1790d3.js";import{_ as I,a as q}from"./uni-popup.8a59f2c5.js";import{d as H}from"./dayjs.min.a11fcfe2.js";import{_ as N}from"./abEmpty.85d112b1.js";import{_ as B}from"./abButton.e151e408.js";import{A as U}from"./abRadio.5b4f04dd.js";let R={},E=null;E=function(){var t=navigator.userAgent,e=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],s=!0;for(let a=0;a<e.length-1;a++)if(t.indexOf(e[a])>0){s=!1;break}return s}(),R={data:()=>({is_show:"none"}),watch:{show(t){this.is_show=this.show}},created(){this.swipeaction=this.getSwipeAction(),this.swipeaction&&Array.isArray(this.swipeaction.children)&&this.swipeaction.children.push(this)},mounted(){this.is_show=this.show},methods:{closeSwipe(t){this.autoClose&&this.swipeaction&&this.swipeaction.closeOther(this)},change(t){this.$emit("change",t.open),this.is_show!==t.open&&(this.is_show=t.open)},appTouchStart(t){if(E)return;const{clientX:e}=t.changedTouches[0];this.clientX=e,this.timestamp=(new Date).getTime()},appTouchEnd(t,e,s,a){if(E)return;const{clientX:o}=t.changedTouches[0];let i=Math.abs(this.clientX-o),n=(new Date).getTime()-this.timestamp;i<40&&n<300&&this.$emit("click",{content:s,index:e,position:a})},onClickForPC(t,e,s){E&&this.$emit("click",{content:e,index:t,position:s})}}};var J=!1;function G(t,e){var s=t.instance,a=s.getDataset().disabled,o=s.getState();Z(s,e),(a=("string"==typeof a?JSON.parse(a):a)||!1)||(s.requestAnimationFrame((function(){s.removeClass("ani"),e.callMethod("closeSwipe")})),o.x=o.left||0,function(t){var e=t.instance,s=e.getState();et(e);var a=t.touches[0];J&&st()&&(a=t);s.startX=a.clientX,s.startY=a.clientY}(t))}function K(t,e){var s=t.instance,a=s.getDataset().disabled,o=s.getState();(a=("string"==typeof a?JSON.parse(a):a)||!1)||(!function(t){var e=t.instance.getState(),s=t.touches[0];J&&st()&&(s=t);e.deltaX=s.clientX-e.startX,e.deltaY=s.clientY-e.startY,e.offsetY=Math.abs(e.deltaY),e.offsetX=Math.abs(e.deltaX),e.direction=e.direction||function(t,e){if(t>e&&t>10)return"horizontal";if(e>t&&e>10)return"vertical";return""}(e.offsetX,e.offsetY)}(t),"horizontal"===o.direction&&(t.preventDefault&&t.preventDefault(),Q(o.x+o.deltaX,s)))}function L(t,e){var s=t.instance,a=s.getDataset().disabled,o=s.getState();(a=("string"==typeof a?JSON.parse(a):a)||!1)||function(t,e,s){var a=e.getState(),o=a.threshold;a.position;var i=a.isopen||"none",n=a.leftWidth,l=a.rightWidth;if(0===a.deltaX)return void tt("none",e,s);tt("none"===i&&l>0&&-t>o||"none"!==i&&l>0&&l+t<o?"right":"none"===i&&n>0&&t>o||"none"!==i&&n>0&&n-t<o?"left":"none",e,s)}(o.left,s,e)}function Q(t,e,s){t=t||0;var a,o,i,n=e.getState(),l=n.leftWidth,r=n.rightWidth;n.left=(a=t,o=-r,i=l,Math.min(Math.max(a,o),i)),e.requestAnimationFrame((function(){e.setStyle({transform:"translateX("+n.left+"px)","-webkit-transform":"translateX("+n.left+"px)"})}))}function Z(t,e){var s,a,o=t.getState(),i=e.selectComponent(".button-group--left"),n=e.selectComponent(".button-group--right");s=i.getBoundingClientRect(),a=n.getBoundingClientRect(),o.leftWidth=s.width||0,o.rightWidth=a.width||0,o.threshold=t.getDataset().threshold}function tt(t,e,s){var a=e.getState(),o=a.leftWidth,i=a.rightWidth,n="";switch(a.isopen=a.isopen?a.isopen:"none",t){case"left":n=o;break;case"right":n=-i;break;default:n=0}a.isopen!==t&&(a.throttle=!0,s.callMethod("change",{open:t})),a.isopen=t,e.requestAnimationFrame((function(){e.addClass("ani"),Q(n,e)}))}function et(t){var e=t.getState();e.direction="",e.deltaX=0,e.deltaY=0,e.offsetX=0,e.offsetY=0}function st(){for(var t=navigator.userAgent,e=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],s=!0,a=0;a<e.length-1;a++)if(t.indexOf(e[a])>0){s=!1;break}return s}"object"==typeof window&&(J=!0);var at=!1;const ot={showWatch:function(t,e,s,a){var o=a.getState();Z(a,s),t&&"none"!==t?tt(t,a,s):(o.left&&tt("none",a,s),et(a))},touchstart:G,touchmove:K,touchend:L,mousedown:function(t,e){J&&st()&&(G(t,e),at=!0)},mousemove:function(t,e){J&&st()&&at&&K(t)},mouseup:function(t,e){J&&st()&&(L(t,e),at=!1)},mouseleave:function(t,e){J&&st()&&(at=!1)}},it=t=>{t.$wxs||(t.$wxs=[]),t.$wxs.push("wxsswipe"),t.mixins||(t.mixins=[]),t.mixins.push({beforeCreate(){this.wxsswipe=ot}})},nt={showWatch(t,e,s,a,o){var i=o.state;(s.$el||s.$vm&&s.$vm.$el)&&(this.getDom(a,s,o),t&&"none"!==t?this.openState(t,a,s,o):(i.left&&this.openState("none",a,s,o),this.resetTouchStatus(a,o)))},touchstart(t,e,s){let a=t.instance,o=a.getDataset().disabled,i=s.state;this.getDom(a,e,s),o=this.getDisabledType(o),o||(a.requestAnimationFrame((function(){a.removeClass("ani"),e.callMethod("closeSwipe")})),i.x=i.left||0,this.stopTouchStart(t,e,s))},touchmove(t,e,s){let a=t.instance;if(!a)return;let o=a.getDataset().disabled,i=s.state;if(o=this.getDisabledType(o),o)return;if(this.stopTouchMove(t,s),"horizontal"!==i.direction)return;t.preventDefault&&t.preventDefault();let n=i.x+i.deltaX;this.move(n,a,e,s)},touchend(t,e,s){let a=t.instance,o=a.getDataset().disabled,i=s.state;o=this.getDisabledType(o),o||this.moveDirection(i.left,a,e,s)},move(t,e,s,a){t=t||0;let o=a.state,i=o.leftWidth,n=o.rightWidth;o.left=this.range(t,-n,i),e.requestAnimationFrame((function(){e.setStyle({transform:"translateX("+o.left+"px)","-webkit-transform":"translateX("+o.left+"px)"})}))},getDom(t,e,s){var a=s.state,o=e.$el||e.$vm&&e.$vm.$el,i=o.querySelector(".button-group--left"),n=o.querySelector(".button-group--right");a.leftWidth=i.offsetWidth||0,a.rightWidth=n.offsetWidth||0,a.threshold=t.getDataset().threshold},getDisabledType:t=>("string"==typeof t?JSON.parse(t):t)||!1,range:(t,e,s)=>Math.min(Math.max(t,e),s),moveDirection(t,e,s,a){var o=a.state,i=o.threshold;o.position;var n=o.isopen||"none",l=o.leftWidth,r=o.rightWidth;0!==o.deltaX?"none"===n&&r>0&&-t>i||"none"!==n&&r>0&&r+t<i?this.openState("right",e,s,a):"none"===n&&l>0&&t>i||"none"!==n&&l>0&&l-t<i?this.openState("left",e,s,a):this.openState("none",e,s,a):this.openState("none",e,s,a)},openState(t,e,s,a){let o=a.state,i=o.leftWidth,n=o.rightWidth,l="";switch(o.isopen=o.isopen?o.isopen:"none",t){case"left":l=i;break;case"right":l=-n;break;default:l=0}o.isopen!==t&&(o.throttle=!0,s.callMethod("change",{open:t})),o.isopen=t,e.requestAnimationFrame((()=>{e.addClass("ani"),this.move(l,e,s,a)}))},getDirection:(t,e)=>t>e&&t>10?"horizontal":e>t&&e>10?"vertical":"",resetTouchStatus(t,e){let s=e.state;s.direction="",s.deltaX=0,s.deltaY=0,s.offsetX=0,s.offsetY=0},stopTouchStart(t,e,s){let a=t.instance,o=s.state;this.resetTouchStatus(a,s);var i=t.touches[0];o.startX=i.clientX,o.startY=i.clientY},stopTouchMove(t,e){t.instance;let s=e.state,a=t.touches[0];s.deltaX=a.clientX-s.startX,s.deltaY=a.clientY-s.startY,s.offsetY=Math.abs(s.deltaY),s.offsetX=Math.abs(s.deltaX),s.direction=s.direction||this.getDirection(s.offsetX,s.offsetY)}},lt={mounted(t,e,s){this.state={}},methods:{showWatch(t,e,s,a){nt.showWatch(t,e,s,a,this)},touchstart(t,e){nt.touchstart(t,e,this)},touchmove(t,e){nt.touchmove(t,e,this)},touchend(t,e){nt.touchend(t,e,this)}}},rt=t=>{t.$renderjs||(t.$renderjs=[]),t.$renderjs.push("renderswipe"),t.mixins||(t.mixins=[]),t.mixins.push({beforeCreate(){this.renderswipe=this},mounted(){this.$ownerInstance=this.$gcd(this,!0)}}),t.mixins.push(lt)},ut={mixins:[R,{},{}],emits:["click","change"],props:{show:{type:String,default:"none"},disabled:{type:Boolean,default:!1},autoClose:{type:Boolean,default:!0},threshold:{type:Number,default:20},leftOptions:{type:Array,default:()=>[]},rightOptions:{type:Array,default:()=>[]}},unmounted(){this.__isUnmounted=!0,this.uninstall()},methods:{uninstall(){this.swipeaction&&this.swipeaction.children.forEach(((t,e)=>{t===this&&this.swipeaction.children.splice(e,1)}))},getSwipeAction(t="uniSwipeAction"){let e=this.$parent,s=e.$options.name;for(;s!==t;){if(e=e.$parent,!e)return!1;s=e.$options.name}return e}}};it(ut),rt(ut);const ct=Y(ut,[["render",function(f,m,g,y,v,x){const b=h,w=p;return t(),e(w,{class:"uni-swipe"},{default:s((()=>[a(w,{class:"uni-swipe_box","change:prop":f.wxsswipe.showWatch,prop:f.is_show,"data-threshold":g.threshold,"data-disabled":g.disabled,onTouchstart:f.wxsswipe.touchstart,onTouchmove:f.wxsswipe.touchmove,onTouchend:f.wxsswipe.touchend},{default:s((()=>[a(w,{class:"uni-swipe_button-group button-group--left"},{default:s((()=>[o(f.$slots,"left",{},(()=>[(t(!0),i(n,null,l(g.leftOptions,((o,i)=>(t(),e(w,{key:i,style:r({backgroundColor:o.style&&o.style.backgroundColor?o.style.backgroundColor:"#C7C6CD"}),class:"uni-swipe_button button-hock",onTouchstart:f.appTouchStart,onTouchend:t=>f.appTouchEnd(t,i,o,"left"),onClick:u((t=>f.onClickForPC(i,o,"left")),["stop"])},{default:s((()=>[a(b,{class:"uni-swipe_button-text",style:r({color:o.style&&o.style.color?o.style.color:"#FFFFFF",fontSize:o.style&&o.style.fontSize?o.style.fontSize:"16px"})},{default:s((()=>[c(d(o.text),1)])),_:2},1032,["style"])])),_:2},1032,["style","onTouchstart","onTouchend","onClick"])))),128))]),!0)])),_:3}),a(w,{class:"uni-swipe_text--center"},{default:s((()=>[o(f.$slots,"default",{},void 0,!0)])),_:3}),a(w,{class:"uni-swipe_button-group button-group--right"},{default:s((()=>[o(f.$slots,"right",{},(()=>[(t(!0),i(n,null,l(g.rightOptions,((o,i)=>(t(),e(w,{key:i,style:r({backgroundColor:o.style&&o.style.backgroundColor?o.style.backgroundColor:"#C7C6CD"}),class:"uni-swipe_button button-hock",onTouchstart:f.appTouchStart,onTouchend:t=>f.appTouchEnd(t,i,o,"right"),onClick:u((t=>f.onClickForPC(i,o,"right")),["stop"])},{default:s((()=>[a(b,{class:"uni-swipe_button-text",style:r({color:o.style&&o.style.color?o.style.color:"#FFFFFF",fontSize:o.style&&o.style.fontSize?o.style.fontSize:"16px"})},{default:s((()=>[c(d(o.text),1)])),_:2},1032,["style"])])),_:2},1032,["style","onTouchstart","onTouchend","onClick"])))),128))]),!0)])),_:3})])),_:3},8,["change:prop","prop","data-threshold","data-disabled","onTouchstart","onTouchmove","onTouchend"])])),_:3})}],["__scopeId","data-v-ae2d0852"]]);const dt=Y({name:"uniSwipeAction",data:()=>({}),created(){this.children=[]},methods:{resize(){},closeAll(){this.children.forEach((t=>{t.is_show="none"}))},closeOther(t){this.openItem&&this.openItem!==t&&(this.openItem.is_show="none"),this.openItem=t}}},[["render",function(a,i,n,l,r,u){const c=p;return t(),e(c,null,{default:s((()=>[o(a.$slots,"default")])),_:3})}]]);const ht=Y({name:"UniSection",emits:["click"],props:{type:{type:String,default:""},title:{type:String,required:!0,default:""},titleFontSize:{type:String,default:"14px"},titleColor:{type:String,default:"#333"},subTitle:{type:String,default:""},subTitleFontSize:{type:String,default:"12px"},subTitleColor:{type:String,default:"#999"},padding:{type:[Boolean,String],default:!1}},computed:{_padding(){return"string"==typeof this.padding?this.padding:this.padding?"10px":""}},watch:{title(t){uni.report&&""!==t&&uni.report("title",t)}},methods:{onClick(){this.$emit("click")}}},[["render",function(i,n,l,u,g,y){const v=p,x=h;return t(),e(v,{class:"uni-section"},{default:s((()=>[a(v,{class:"uni-section-header",onClick:y.onClick},{default:s((()=>[l.type?(t(),e(v,{key:0,class:f(["uni-section-header__decoration",l.type])},null,8,["class"])):o(i.$slots,"decoration",{key:1},void 0,!0),a(v,{class:"uni-section-header__content"},{default:s((()=>[a(x,{style:r({"font-size":l.titleFontSize,color:l.titleColor}),class:f(["uni-section__content-title",{distraction:!l.subTitle}])},{default:s((()=>[c(d(l.title),1)])),_:1},8,["style","class"]),l.subTitle?(t(),e(x,{key:0,style:r({"font-size":l.subTitleFontSize,color:l.subTitleColor}),class:"uni-section-header__content-sub"},{default:s((()=>[c(d(l.subTitle),1)])),_:1},8,["style"])):m("",!0)])),_:1}),a(v,{class:"uni-section-header__slot-right"},{default:s((()=>[o(i.$slots,"right",{},void 0,!0)])),_:3})])),_:3},8,["onClick"]),a(v,{class:"uni-section-content",style:r({padding:y._padding})},{default:s((()=>[o(i.$slots,"default",{},void 0,!0)])),_:3},8,["style"])])),_:3})}],["__scopeId","data-v-0a8818d5"]]),pt=Y({__name:"index",setup(o){let r=g();y("setAdd",(function(t){console.log(t);let e=f.value.findIndex((e=>e.desk==t.desk));f.value[e].undoneRecord=!0})),F((()=>{r?M({token:r}).then((t=>{console.log(t)})).catch((t=>{v({url:"/pages/login/login"})})):v({url:"/pages/login/login"})}));const h=x({startTime:"",endTime:""});H().hour()<12?(h.startTime=H().startOf("day").subtract(12,"hour").format("YYYY-MM-DD HH:mm:ss"),h.endTime=H().endOf("day").subtract(12,"hour").format("YYYY-MM-DD HH:mm:ss")):(h.startTime=H().startOf("day").add(12,"hour").format("YYYY-MM-DD HH:mm:ss"),h.endTime=H().endOf("day").add(12,"hour").format("YYYY-MM-DD HH:mm:ss"));const f=b([]);X((async()=>{let t=await $(h);f.value=t,it.value="",w()}));const Y=x([{text:"设置已完成",style:{backgroundColor:"#dd524d",fontSize:"14px"}}]),R=x({actualMoney:"",id:"",isFinish:!0}),E=["正常辣","微辣","特辣"],J=["","warning","error"],G=b(null),K=async()=>{await O(R),S({title:"设置成功",icon:"success",mask:!0});let t=await $(h);f.value=t,G.value.close()},L=b(null),Q=b("1"),Z=b("1"),tt=b(""),et=b(""),st=b(null),at=()=>{L.value.open();let t=H().format("HH:mm");tt.value=t+"-"+(f.value.length+1)+"号订单"},ot=async()=>{if(tt.value)try{let t=await V({orderName:tt.value,isPack:"2"==Q.value,taste:Number(Z.value),isFinish:!1,totalMoney:0,actualMoney:0,desk:Number(et.value)||""});L.value.close(),t&&(S({title:"创建成功,请添加菜品",icon:"none",mask:!0}),setTimeout((()=>{C({url:"/pages/orderDetail/index?id="+t})}),1e3))}catch(t){L.value.close()}else st.value._Focus()};W((async()=>{let t=await $(h);f.value=t}));const it=b(""),nt=async()=>{let t=await $({id:it.value});f.value=t},lt=async()=>{k({title:"提示",content:"确定要设置所有订单已完成吗？",success:async({confirm:t,cancel:e})=>{t&&(await z(),S({title:"设置成功",icon:"success"}))}})};return(o,r)=>{const h=A(T("uni-easyinput"),D),g=A(T("uni-tag"),P),y=p,v=A(T("uni-swipe-action-item"),ct),x=A(T("uni-swipe-action"),dt),b=A(T("uni-section"),ht),w=A(T("uni-popup-dialog"),I),k=A(T("uni-popup"),q);return t(),i("div",{class:"mt-[20rpx]"},[_("div",{class:"px-[12px] mb-[12px]"},[a(h,{clearable:"",prefixIcon:"search",confirmType:"搜索",modelValue:it.value,"onUpdate:modelValue":r[0]||(r[0]=t=>it.value=t),onBlur:nt,placeholder:"输入订单ID精准查询"},null,8,["modelValue"])]),a(x,null,{default:s((()=>[(t(!0),i(n,null,l(f.value,(o=>(t(),e(v,{key:o.id,"right-options":Y,onClick:t=>(async t=>{G.value.open(),R.id=t.id,R.isFinish=!0,R.actualMoney=t.actualMoney})(o),disabled:o.isFinish,class:"mb-2"},{default:s((()=>[a(y,{onClick:u((t=>((t,e)=>{C({url:"/pages/orderDetail/index?id="+t.id+"&name="+e})})(o,(t=>t.orderName+(t.desk?"-"+t.desk+"号桌":""))(o))),["stop"]),class:"flex shadow-lg py-[20rpx] px-[20rpx] items-center relative",style:{border:"2rpx solid #f5f5f5"}},{default:s((()=>[_("div",{class:"text-text2 text-14"},[_("p",null,d(o.orderName),1),_("p",{class:"text-12"},"创建时间："+d(o.showTime),1)]),_("div",{class:"ml-auto"},[o.taste&&1!=o.taste?(t(),e(g,{key:0,type:J[o.taste-1],style:{"margin-right":"4px"},text:E[o.taste-1],size:"small"},null,8,["type","text"])):m("",!0),o.isPack?(t(),e(g,{key:1,style:{"margin-right":"4px"},text:"打包",size:"small",type:"warning"})):m("",!0),o.desk?(t(),e(g,{key:2,style:{"margin-right":"4px"},text:o.desk+"号桌",size:"small",type:"primary"},null,8,["text"])):m("",!0),a(g,{text:o.isFinish?"已完成":"进行中",size:"small",type:o.isFinish?"":"primary"},null,8,["text","type"])]),o.undoneRecord?(t(),i("span",{key:0,class:"absolute top-0 rotate-45 text-12 text-text3 left-1/2 scale-75",style:{border:"1px solid red"}},"有加菜")):m("",!0),o.isRead||o.isRead||o.isFinish?m("",!0):(t(),e(j,{key:1}))])),_:2},1032,["onClick"])])),_:2},1032,["right-options","onClick","disabled"])))),128))])),_:1}),0===f.value.length?(t(),e(N,{key:0})):m("",!0),_("div",{class:"px-[20rpx] mt-[20rpx] pb-[20px]"},[a(B,{icon:"plusempty",onClick:at},{default:s((()=>[c("新增订单")])),_:1}),a(B,{icon:"gear",class:"mt-[12px]",type:"primary",onClick:lt},{default:s((()=>[c("一键设置订单完成")])),_:1})]),a(k,{ref_key:"popup1",ref:G,type:"dialog"},{default:s((()=>[a(w,{duration:2e3,"before-close":!0,onClose:r[2]||(r[2]=t=>G.value.close()),onConfirm:K},{default:s((()=>[a(b,{title:"实收金额",type:"line",padding:""},{default:s((()=>[a(h,{errorMessage:"",modelValue:R.actualMoney,"onUpdate:modelValue":r[1]||(r[1]=t=>R.actualMoney=t),type:"number",focus:"",placeholder:"请输入收款金额"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},512),a(k,{ref_key:"popup2",ref:L,type:"dialog"},{default:s((()=>[a(w,{title:"添加订单",duration:2e3,"before-close":!0,onClose:r[7]||(r[7]=t=>L.value.close()),onConfirm:ot},{default:s((()=>[_("div",{class:"w-full"},[_("div",null,[a(h,{ref_key:"nameInput",ref:st,errorMessage:"",modelValue:tt.value,"onUpdate:modelValue":r[3]||(r[3]=t=>tt.value=t),type:"text",focus:"",placeholder:"请输入订单名称"},null,8,["modelValue"]),tt.value?m("",!0):(t(),i("p",{key:0,class:"text-text3 text-12"},"请输入订单名称"))]),_("div",{class:"flex justify-start mt-[10px]"},[a(U,{modelValue:Q.value,"onUpdate:modelValue":r[4]||(r[4]=t=>Q.value=t),list:[{label:"在这吃",value:"1"},{label:"打包",value:"2"}]},null,8,["modelValue"])]),_("div",{class:"flex justify-start mt-[8rpx]"},[a(U,{modelValue:Z.value,"onUpdate:modelValue":r[5]||(r[5]=t=>Z.value=t),list:[{label:"正常辣",value:"1"},{label:"微辣",value:"2"},{label:"特辣",value:"3"}]},null,8,["modelValue"])]),_("div",{class:"mt-[10px]"},[a(h,{modelValue:et.value,"onUpdate:modelValue":r[6]||(r[6]=t=>et.value=t),type:"number",placeholder:"请输入桌号(可不填)"},null,8,["modelValue"])])])])),_:1})])),_:1},512)])}}},[["__scopeId","data-v-6cfd93c6"]]);export{pt as default};
