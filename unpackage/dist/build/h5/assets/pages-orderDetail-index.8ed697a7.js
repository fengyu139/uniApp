import{o as e,c as t,w as a,a as l,n as s,h as u,f as i,i as n,g as o,Z as r,A as c,b as d,q as p,F as m,d as f,D as v,t as y,j as h,G as x,I as b,a1 as g,B as k,p as _,u as C,k as D,$ as V,ax as w,v as q,E as S,a0 as N,ay as B,a8 as F,ah as O,s as j,az as I}from"./index-95f3bf04.js";import{_ as E}from"./uni-easyinput.3f6dde31.js";import{_ as L,r as $,t as J,f as A,g as M,v as T,w as U,i as z,o as R,m as H,c as G,b as P}from"./api.8503b51a.js";import{a as Y,_ as Z,b as K}from"./uni-popup.ee48415f.js";import{i as Q}from"./imgErr.8cf36142.js";import{_ as W}from"./abEmpty.c82de8bb.js";import{d as X}from"./dayjs.min.b1dcbba1.js";import{_ as ee}from"./abMiniButton.c3fdce0a.js";import{_ as te}from"./addRecords.eb496b67.js";import{A as ae}from"./abRadio.a8787a56.js";import{s as le}from"./globalStore.4bca411e.js";const se=L({name:"UniNumberBox",emits:["change","input","update:modelValue","blur","focus"],props:{value:{type:[Number,String],default:1},modelValue:{type:[Number,String],default:1},min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1},background:{type:String,default:"#f5f5f5"},color:{type:String,default:"#333"},disabled:{type:Boolean,default:!1}},data:()=>({inputValue:0}),watch:{value(e){this.inputValue=+e},modelValue(e){this.inputValue=+e}},created(){1===this.value&&(this.inputValue=+this.modelValue),1===this.modelValue&&(this.inputValue=+this.value)},methods:{_calcValue(e){if(this.disabled)return;const t=this._getDecimalScale();let a=this.inputValue*t,l=this.step*t;if("minus"===e){if(a-=l,a<this.min*t)return;a>this.max*t&&(a=this.max*t)}if("plus"===e){if(a+=l,a>this.max*t)return;a<this.min*t&&(a=this.min*t)}this.inputValue=(a/t).toFixed(String(t).length-1),this.$emit("input",+this.inputValue),this.$emit("update:modelValue",+this.inputValue),this.$emit("change",+this.inputValue)},_getDecimalScale(){let e=1;return~~this.step!==this.step&&(e=Math.pow(10,String(this.step).split(".")[1].length)),e},_onBlur(e){this.$emit("blur",e);let t=e.detail.value;if(isNaN(t))return void(this.inputValue=this.min);t=+t,t>this.max?t=this.max:t<this.min&&(t=this.min);const a=this._getDecimalScale();this.inputValue=t.toFixed(String(a).length-1),this.$emit("input",+this.inputValue),this.$emit("update:modelValue",+this.inputValue),this.$emit("change",+this.inputValue)},_onFocus(e){this.$emit("focus",e)}}},[["render",function(c,d,p,m,f,v){const y=n,h=o,x=r;return e(),t(h,{class:"uni-numbox"},{default:a((()=>[l(h,{onClick:d[0]||(d[0]=e=>v._calcValue("minus")),class:"uni-numbox__minus uni-numbox-btns",style:s({background:p.background})},{default:a((()=>[l(y,{class:u(["uni-numbox--text",{"uni-numbox--disabled":f.inputValue<=p.min||p.disabled}]),style:s({color:p.color})},{default:a((()=>[i("-")])),_:1},8,["class","style"])])),_:1},8,["style"]),l(x,{disabled:p.disabled,onFocus:v._onFocus,onBlur:v._onBlur,class:"uni-numbox__value",type:"number",modelValue:f.inputValue,"onUpdate:modelValue":d[1]||(d[1]=e=>f.inputValue=e),style:s({background:p.background,color:p.color})},null,8,["disabled","onFocus","onBlur","modelValue","style"]),l(h,{onClick:d[2]||(d[2]=e=>v._calcValue("plus")),class:"uni-numbox__plus uni-numbox-btns",style:s({background:p.background})},{default:a((()=>[l(y,{class:u(["uni-numbox--text",{"uni-numbox--disabled":f.inputValue>=p.max||p.disabled}]),style:s({color:p.color})},{default:a((()=>[i("+")])),_:1},8,["class","style"])])),_:1},8,["style"])])),_:1})}],["__scopeId","data-v-2cc6f69d"]]),ue={__name:"abMenuList",props:{list:{type:Array,default:()=>[]},disabledBtn:{type:Boolean,default:!1}},setup:a=>(s,u)=>{const i=g,n=$(c("uni-number-box"),se);return e(),d(m,null,[p("ul",{class:"w-full"},[(e(!0),d(m,null,f(a.list,((t,s)=>(e(),d("li",{key:s,class:"flex p-[8px] mb-[12px] w-full mx-[12px] items-center",style:{"border-bottom":"1px solid var(--border_c)"}},[l(i,{src:t.picImg||v(Q),onError:e=>(e=>{e.picImg=Q})(t),onClick:e=>{var a;(a=t.picImg).includes("imgErr")||x({urls:[a]})},class:"w-[60px] h-[60px]"},null,8,["src","onError","onClick"]),p("div",{class:"ml-[10px]"},[p("p",null,y(t.name),1),p("p",null,[p("span",{class:"text-text3"},y(t.price.toFixed(2)),1),p("span",{class:"text-text2 text-12"},"/"+y(t.unit),1)]),l(n,{modelValue:t.count,"onUpdate:modelValue":e=>t.count=e,min:0,onChange:u[0]||(u[0]=e=>{b("shake")}),disabled:a.disabledBtn},null,8,["modelValue","onUpdate:modelValue","disabled"])])])))),128))]),a.list.length?h("",!0):(e(),t(W,{key:0,text:"暂无数据"}))],64)}},ie=L({__name:"orderBottom",props:{list:{type:Array,default:()=>[]},isChange:{type:Boolean,default:!1},queryData:{type:Object,default:()=>{}},allList:{type:Array,default:()=>[]},backupData:{type:Array,default:()=>[]}},emits:["clear","updateClone","initOrder","setCloneData"],setup(s,{emit:u}){const n=s,r=w("btnStutas"),x=w("socket"),b=k((()=>{let e=n.list.reduce(((e,t)=>e+t.price*t.count),0);return parseFloat(e.toFixed(2))})),g=k((()=>n.list.reduce(((e,t)=>e+t.count),0))),F=async()=>{if(n.isChange){if(n.queryData.id){let e=[];n.list.forEach((t=>{const a=n.backupData.find((e=>e.id==t.id));if(t.count!=a.count){let l=JSON.parse(JSON.stringify(t));l.count=t.count-a.count,l.count>0&&e.push({id:l.id,count:l.count,price:l.price,name:l.name})}})),await A({id:n.queryData.id,orderDetail:n.list.map((e=>({id:e.id,count:e.count,price:e.price,name:e.name}))),totalMoney:b.value,totalCount:g.value,recordsList:e.length?e:"",isAdmin:!0}),u("setCloneData")}else{let e=X().format("HH:mm"),t=await M({orderName:e+"-"+n.queryData.desk+"号桌",isPack:!1,taste:Number(R.value),isFinish:!1,totalCount:g.value,totalMoney:b.value,orderDetail:n.list.filter((e=>e.count>0)),actualMoney:0,desk:Number(n.queryData.desk)||"",userOperation:!0,isRead:!1},!0);console.log(t),D()||(r.value=!0,x.emit("message",{desk:n.queryData.desk,type:"submitted",orderId:t.data})),n.queryData.id=t.data,t.orderFlag&&(S("orderId",t.data),N({url:"/pages/orderDetail/orderInfo"})),L.value.close()}u("updateClone"),q({icon:"success",title:"已提交"})}else q({title:"没有更改，无需提交",icon:"none"})},O=_(null),j=_([]),I=async()=>{let e=await T({orderId:n.queryData.id||"234wert"});j.value=e,O.value.open()};J((()=>{n.isChange&&C({title:"提示",content:"订单未保存，是否保存",success:async({confirm:e,cancel:t})=>!e||(await F(),!0)})}));const E=()=>{C({title:"提示",content:"确定要清空所有选项吗",showCancel:!0,success:({confirm:e,cancel:t})=>{e&&(u("clear"),q({icon:"success"}))}})},L=_(null),R=_("1"),H=async()=>{F()};let G=[];const P=_(!1),K=()=>{q({title:"已重置菜单，请选择您要添加的菜品",icon:"none",mask:!1}),G=JSON.parse(JSON.stringify(n.allList)),r.value=!1,P.value=!0,u("clear")},Q=async()=>{let e=n.list.filter((e=>e.count>0));await U({orderId:n.queryData.id,desk:n.queryData.desk,items:e,totalMoney:b.value,totalCount:g.value});let t="";e.forEach((e=>{t+=` ${e.name}  x ${e.count} \n`})),D()||x.emit("message",{msg:t,desk:n.queryData.desk,type:"addFoods",orderId:n.queryData.id}),C({title:"提示",content:"提交成功，等待上菜吧",confirmText:"知道了",showCancel:!1}),r.value=!0,P.value=!1,u("initOrder")},le=()=>{C({title:"提示",content:"是否放弃本次加菜",showCancel:!0,success:({confirm:e,cancel:t})=>{e&&(r.value=!0,P.value=!1,u("updateClone",G))}})},se=_(1),ue=async()=>{C({title:"设置桌号",content:se.value,editable:!0,placeholderText:"请输入桌号",showCancel:!0,success:async({confirm:e,cancel:t,content:a})=>{e&&(await A({id:n.queryData.id,desk:Number(a)}),q({title:"成功",icon:"success",mask:!0}))}})};x.on("message",(e=>{if(n.queryData.desk&&n.queryData.desk==e.desk){if("submitted"==e.type)return void C({title:"提示",content:"您的同桌已经提交了订单",showCancel:!1,confirmText:"知道了",success:()=>{u("initOrder")}});D()||C({title:"来自您同桌的加菜",content:e.msg,showCancel:!1,confirmText:"知道了",success:()=>{u("initOrder")}})}}));const ie=()=>{console.log(dhDom),dhDom.classList.remove("shake-top"),setTimeout((()=>{dhDom.classList.add("shake-top")}),0)};return V("shake",(e=>{ie()})),(u,n)=>{const x=$(c("uni-icons"),z),k=o,_=B,C=$(c("uni-popup"),Y),V=$(c("uni-popup-dialog"),Z);return e(),d("div",null,[p("div",{class:"h-[40px] flex items-center px-[10px]"},[p("span",{class:"flex items-center text-text3 text-16 font-bold",onClick:ie},[p("div",{ref:"dhDom",id:"dhDom"},[l(x,{type:"cart",color:"",size:"24",class:"mr-[2px]"})],512),i(" "+y(v(b).toFixed(2)),1)]),l(k,{class:"ml-auto mr-[10px]"},{default:a((()=>[l(ee,{type:"warn",onClick:E,icon:"close"},{default:a((()=>[i("清空")])),_:1})])),_:1}),v(D)()?(e(),t(k,{key:0,class:"mr-[10px]"},{default:a((()=>[l(ee,{onClick:ue},{default:a((()=>[i("设置桌号")])),_:1})])),_:1})):h("",!0),l(k,{class:"mr-[10px]"},{default:a((()=>[l(ee,{onClick:I},{default:a((()=>[i("查看明细")])),_:1})])),_:1}),s.queryData.desk&&v(r)?(e(),t(k,{key:1,class:"mr-[10px]"},{default:a((()=>[l(ee,{onClick:K},{default:a((()=>[i("我要加菜")])),_:1})])),_:1})):h("",!0),!v(r)&&P.value?(e(),t(k,{key:2,class:"mr-[10px]"},{default:a((()=>[l(ee,{onClick:le},{default:a((()=>[i("取消")])),_:1})])),_:1})):h("",!0),v(r)||!P.value||s.list.every((e=>0==e.count))?h("",!0):(e(),t(k,{key:3,class:"mr-[10px]"},{default:a((()=>[l(ee,{type:"warn",icon:"plusempty",onClick:Q},{default:a((()=>[i("选好了")])),_:1})])),_:1})),s.queryData.id&&!s.queryData.desk?(e(),t(k,{key:4,class:""},{default:a((()=>[l(ee,{type:"warn",onClick:F},{default:a((()=>[i("提交")])),_:1})])),_:1})):h("",!0),s.queryData.id?h("",!0):(e(),t(k,{key:5,class:""},{default:a((()=>[l(ee,{type:"warn",onClick:n[0]||(n[0]=e=>L.value.open())},{default:a((()=>[i("提交")])),_:1})])),_:1}))]),l(C,{ref_key:"popupOne",ref:O,type:"bottom"},{default:a((()=>[l(k,{class:"bg-bg3 p-[12px]"},{default:a((()=>[p("div",{class:"flex justify-center items-center px-[10px]"},[p("span",{class:"text-16 font-bold text-text2 ml-auto"},"订单汇总"),l(x,{class:"ml-auto",type:"closeempty",onClick:n[1]||(n[1]=e=>O.value.close()),color:"#ccc",size:"24"})]),l(_,{"scroll-y":"true",style:{"max-height":"80vh"}},{default:a((()=>[s.list.length?(e(),d("div",{key:0},[p("ul",null,[p("li",{class:"grid grid-cols-4 text-center py-[4px] font-bold"},[p("span",null,"名称"),p("span",null,"单价"),p("span",null,"数量"),p("span",null,"小记")]),(e(!0),d(m,null,f(s.list,(t=>(e(),d("li",{key:t.id,class:"grid grid-cols-4 text-center py-[4px]",style:{"border-bottom":"1px solid var(--border_c)"}},[p("span",null,y(t.name),1),p("span",null,y(t.price.toFixed(2)),1),p("span",null,y(t.count),1),p("span",{class:"text-text3"},y((t.price*t.count).toFixed(2)),1)])))),128))]),p("div",{class:"mt-[12px] flex justify-center"},[p("span",{class:"text-text3 font-bold mr-[10px]"},"总数量:"+y(v(g)),1),p("span",{class:"text-text3 font-bold"},"总计:"+y(v(b)),1)])])):(e(),t(W,{key:1,text:"暂无数据"})),j.value.length>1?(e(),t(te,{key:2,recordsList:j.value},null,8,["recordsList"])):h("",!0)])),_:1})])),_:1})])),_:1},512),l(C,{ref_key:"popupTwo",ref:L,type:"dialog"},{default:a((()=>[l(V,{title:"添加订单",duration:2e3,"before-close":!0,onClose:n[3]||(n[3]=e=>L.value.close()),onConfirm:H},{default:a((()=>[p("div",{class:"w-full"},[l(ae,{modelValue:R.value,"onUpdate:modelValue":n[2]||(n[2]=e=>R.value=e),list:[{label:"正常辣",value:"1"},{label:"微辣",value:"2"},{label:"特辣",value:"3"}]},null,8,["modelValue"])])])),_:1})])),_:1},512)])}}},[["__scopeId","data-v-4ea558c4"]]),ne=L({__name:"index",setup(n){const o=_([]),r=_({}),x=_(""),b=_(1),g=_(0);let C=_([]);const V=_({});R((async e=>{V.value=e;let t="欢迎点餐";(e.name||e.desk)&&(t=e.name||e.desk+"号桌"),F({title:t}),N()}));const w=_(!1);I("btnStutas",w);const q=k((()=>{var e;return(null==(e=r.value)?void 0:e.isFinish)||V.value.desk&&w.value})),N=async()=>{let e=O("menuList");if(e&&D())o.value=e;else{let e=await H({filter:!0});o.value=e,S("menuList",e)}o.value.forEach((e=>{e.count=0})),C.value=o.value.map((e=>e.count));let t={};if(V.value.id?t={id:V.value.id}:V.value.desk&&(t={desk:V.value.desk,isFinish:!1}),Object.keys(t).length){let e=await G(t,!0);if(!e.length)return;r.value=e[0],r.value.desk==V.value.desk&&(w.value=!0),V.value.id=r.value.id,o.value.forEach((e=>{e.count=0,r.value.orderDetail.forEach((t=>{e.id==t.id&&(e.count=t.count)}))})),C.value=o.value.map((e=>e.count)),J()}},L=_([]),J=()=>{L.value=JSON.parse(JSON.stringify(o.value))};P((async()=>{await N(),j()}));const A=k((()=>o.value.filter((e=>e.count)))),M=k((()=>JSON.stringify(C.value)!=JSON.stringify(o.value.map((e=>e.count))))),T=k((()=>{let e={};return le.value.forEach((t=>{e[t.value]=o.value.filter((e=>e.type==t.value&&e.count)).reduce(((e,t)=>e+Number(t.count)),0)})),e})),U=()=>{o.value.forEach((e=>{e.count=0}))},z=e=>{console.log(e),e&&(o.value=e),C.value=o.value.map((e=>e.count))},Z=()=>{Q.value.open()},Q=_(null);return(n,r)=>{const k=$(c("uni-easyinput"),E),_=$(c("uni-transition"),K),C=B,D=$(c("uni-popup"),Y);return e(),d(m,null,[p("div",{class:"p-[12px]"},[l(k,{clearable:"",prefixIcon:"search",confirmType:"搜索",modelValue:x.value,"onUpdate:modelValue":r[0]||(r[0]=e=>x.value=e),onBlur:Z,placeholder:"请输入关键字"},null,8,["modelValue"])]),p("div",{class:"flex",style:{height:"calc(100% - 98px)"}},[p("div",{class:"h-full bg-bg1 w-1/3"},[p("ul",{class:"text-text2"},[(e(!0),d(m,null,f(v(le),((t,a)=>(e(),d("li",{class:u(["text-center py-[8px] my-[4px] relative",{active:t.value==b.value}]),key:a,onClick:e=>{b.value=t.value,g.value=a}},[i(y(t.text)+" ",1),t.value==b.value?(e(),d("div",{key:0,class:"absolute left-[4px] top-[8px]"},[l(_,{"mode-class":"slide-bottom",styles:{width:"4px",height:"20px",backgroundColor:"red"},show:t.value==b.value,onChange:n.change},null,8,["show","onChange"])])):h("",!0),v(T)[t.value]?(e(),d("span",{key:1,class:"bg-bg2 text-text4 rounded-md text-12 px-[6px] absolute top-0 right-[2px] scale-[80%]"},y(v(T)[t.value]),1)):h("",!0)],10,["onClick"])))),128))])]),p("div",{class:"h-full overflow-hidden w-2/3"},[p("div",{class:"h-full scrollDom",style:s({transform:`translateY(-${100*g.value}%)`})},[(e(!0),d(m,null,f(v(le),(s=>(e(),t(C,{"scroll-y":"true",class:"h-full",key:s.value},{default:a((()=>[l(ue,{list:o.value.filter((e=>e.type==s.value)),disabledBtn:v(q)},null,8,["list","disabledBtn"])])),_:2},1024)))),128))],4)])]),l(ie,{list:v(A),allList:o.value,backupData:L.value,isChange:v(M),queryData:V.value,onClear:U,onUpdateClone:z,onInitOrder:N,onSetCloneData:J},null,8,["list","allList","backupData","isChange","queryData"]),l(D,{ref_key:"popupOne",ref:Q,type:"bottom"},{default:a((()=>[p("div",{class:"p-[12px] bg-bg3"},[l(ue,{list:o.value.filter((e=>e.name.includes(x.value?x.value:"qwe12323sdss"))),disabledBtn:v(q)},null,8,["list","disabledBtn"])])])),_:1},512)],64)}}},[["__scopeId","data-v-a1b9a7a8"]]);export{ne as default};
