import{o as t,c as e,w as s,a as o,r as a,b as i,F as n,d as l,n as r,e as u,f as c,t as d,i as h,g as p,h as f,j as m,k as g,$ as y,l as v,m as b,p as x,s as w,q as _,u as k,v as S,x as C,y as T}from"./index-252a0b36.js";import{_ as D}from"./uni-easyinput.e36f5bfe.js";import{_ as Y,o as F,a as M,b as X,c as $,d as W,s as z,r as A,e as O,f as V}from"./api.5dfc4364.js";import{_ as j}from"./uni-tag.ec1bc0a0.js";import{_ as P,a as I}from"./uni-popup.41edc112.js";import{d as q}from"./dayjs.min.fc82c652.js";import{_ as H}from"./abEmpty.dc2aa413.js";import{_ as N}from"./abButton.c545a371.js";import{A as U}from"./abRadio.f5dc2a19.js";let B={},E=null;E=function(){var t=navigator.userAgent,e=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],s=!0;for(let o=0;o<e.length-1;o++)if(t.indexOf(e[o])>0){s=!1;break}return s}(),B={data:()=>({is_show:"none"}),watch:{show(t){this.is_show=this.show}},created(){this.swipeaction=this.getSwipeAction(),this.swipeaction&&Array.isArray(this.swipeaction.children)&&this.swipeaction.children.push(this)},mounted(){this.is_show=this.show},methods:{closeSwipe(t){this.autoClose&&this.swipeaction&&this.swipeaction.closeOther(this)},change(t){this.$emit("change",t.open),this.is_show!==t.open&&(this.is_show=t.open)},appTouchStart(t){if(E)return;const{clientX:e}=t.changedTouches[0];this.clientX=e,this.timestamp=(new Date).getTime()},appTouchEnd(t,e,s,o){if(E)return;const{clientX:a}=t.changedTouches[0];let i=Math.abs(this.clientX-a),n=(new Date).getTime()-this.timestamp;i<40&&n<300&&this.$emit("click",{content:s,index:e,position:o})},onClickForPC(t,e,s){E&&this.$emit("click",{content:e,index:t,position:s})}}};var R=!1;function J(t,e){var s=t.instance,o=s.getDataset().disabled,a=s.getState();Q(s,e),(o=("string"==typeof o?JSON.parse(o):o)||!1)||(s.requestAnimationFrame((function(){s.removeClass("ani"),e.callMethod("closeSwipe")})),a.x=a.left||0,function(t){var e=t.instance,s=e.getState();tt(e);var o=t.touches[0];R&&et()&&(o=t);s.startX=o.clientX,s.startY=o.clientY}(t))}function G(t,e){var s=t.instance,o=s.getDataset().disabled,a=s.getState();(o=("string"==typeof o?JSON.parse(o):o)||!1)||(!function(t){var e=t.instance.getState(),s=t.touches[0];R&&et()&&(s=t);e.deltaX=s.clientX-e.startX,e.deltaY=s.clientY-e.startY,e.offsetY=Math.abs(e.deltaY),e.offsetX=Math.abs(e.deltaX),e.direction=e.direction||function(t,e){if(t>e&&t>10)return"horizontal";if(e>t&&e>10)return"vertical";return""}(e.offsetX,e.offsetY)}(t),"horizontal"===a.direction&&(t.preventDefault&&t.preventDefault(),L(a.x+a.deltaX,s)))}function K(t,e){var s=t.instance,o=s.getDataset().disabled,a=s.getState();(o=("string"==typeof o?JSON.parse(o):o)||!1)||function(t,e,s){var o=e.getState(),a=o.threshold;o.position;var i=o.isopen||"none",n=o.leftWidth,l=o.rightWidth;if(0===o.deltaX)return void Z("none",e,s);Z("none"===i&&l>0&&-t>a||"none"!==i&&l>0&&l+t<a?"right":"none"===i&&n>0&&t>a||"none"!==i&&n>0&&n-t<a?"left":"none",e,s)}(a.left,s,e)}function L(t,e,s){t=t||0;var o,a,i,n=e.getState(),l=n.leftWidth,r=n.rightWidth;n.left=(o=t,a=-r,i=l,Math.min(Math.max(o,a),i)),e.requestAnimationFrame((function(){e.setStyle({transform:"translateX("+n.left+"px)","-webkit-transform":"translateX("+n.left+"px)"})}))}function Q(t,e){var s,o,a=t.getState(),i=e.selectComponent(".button-group--left"),n=e.selectComponent(".button-group--right");s=i.getBoundingClientRect(),o=n.getBoundingClientRect(),a.leftWidth=s.width||0,a.rightWidth=o.width||0,a.threshold=t.getDataset().threshold}function Z(t,e,s){var o=e.getState(),a=o.leftWidth,i=o.rightWidth,n="";switch(o.isopen=o.isopen?o.isopen:"none",t){case"left":n=a;break;case"right":n=-i;break;default:n=0}o.isopen!==t&&(o.throttle=!0,s.callMethod("change",{open:t})),o.isopen=t,e.requestAnimationFrame((function(){e.addClass("ani"),L(n,e)}))}function tt(t){var e=t.getState();e.direction="",e.deltaX=0,e.deltaY=0,e.offsetX=0,e.offsetY=0}function et(){for(var t=navigator.userAgent,e=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],s=!0,o=0;o<e.length-1;o++)if(t.indexOf(e[o])>0){s=!1;break}return s}"object"==typeof window&&(R=!0);var st=!1;const ot={showWatch:function(t,e,s,o){var a=o.getState();Q(o,s),t&&"none"!==t?Z(t,o,s):(a.left&&Z("none",o,s),tt(o))},touchstart:J,touchmove:G,touchend:K,mousedown:function(t,e){R&&et()&&(J(t,e),st=!0)},mousemove:function(t,e){R&&et()&&st&&G(t)},mouseup:function(t,e){R&&et()&&(K(t,e),st=!1)},mouseleave:function(t,e){R&&et()&&(st=!1)}},at=t=>{t.$wxs||(t.$wxs=[]),t.$wxs.push("wxsswipe"),t.mixins||(t.mixins=[]),t.mixins.push({beforeCreate(){this.wxsswipe=ot}})},it={showWatch(t,e,s,o,a){var i=a.state;(s.$el||s.$vm&&s.$vm.$el)&&(this.getDom(o,s,a),t&&"none"!==t?this.openState(t,o,s,a):(i.left&&this.openState("none",o,s,a),this.resetTouchStatus(o,a)))},touchstart(t,e,s){let o=t.instance,a=o.getDataset().disabled,i=s.state;this.getDom(o,e,s),a=this.getDisabledType(a),a||(o.requestAnimationFrame((function(){o.removeClass("ani"),e.callMethod("closeSwipe")})),i.x=i.left||0,this.stopTouchStart(t,e,s))},touchmove(t,e,s){let o=t.instance;if(!o)return;let a=o.getDataset().disabled,i=s.state;if(a=this.getDisabledType(a),a)return;if(this.stopTouchMove(t,s),"horizontal"!==i.direction)return;t.preventDefault&&t.preventDefault();let n=i.x+i.deltaX;this.move(n,o,e,s)},touchend(t,e,s){let o=t.instance,a=o.getDataset().disabled,i=s.state;a=this.getDisabledType(a),a||this.moveDirection(i.left,o,e,s)},move(t,e,s,o){t=t||0;let a=o.state,i=a.leftWidth,n=a.rightWidth;a.left=this.range(t,-n,i),e.requestAnimationFrame((function(){e.setStyle({transform:"translateX("+a.left+"px)","-webkit-transform":"translateX("+a.left+"px)"})}))},getDom(t,e,s){var o=s.state,a=e.$el||e.$vm&&e.$vm.$el,i=a.querySelector(".button-group--left"),n=a.querySelector(".button-group--right");o.leftWidth=i.offsetWidth||0,o.rightWidth=n.offsetWidth||0,o.threshold=t.getDataset().threshold},getDisabledType:t=>("string"==typeof t?JSON.parse(t):t)||!1,range:(t,e,s)=>Math.min(Math.max(t,e),s),moveDirection(t,e,s,o){var a=o.state,i=a.threshold;a.position;var n=a.isopen||"none",l=a.leftWidth,r=a.rightWidth;0!==a.deltaX?"none"===n&&r>0&&-t>i||"none"!==n&&r>0&&r+t<i?this.openState("right",e,s,o):"none"===n&&l>0&&t>i||"none"!==n&&l>0&&l-t<i?this.openState("left",e,s,o):this.openState("none",e,s,o):this.openState("none",e,s,o)},openState(t,e,s,o){let a=o.state,i=a.leftWidth,n=a.rightWidth,l="";switch(a.isopen=a.isopen?a.isopen:"none",t){case"left":l=i;break;case"right":l=-n;break;default:l=0}a.isopen!==t&&(a.throttle=!0,s.callMethod("change",{open:t})),a.isopen=t,e.requestAnimationFrame((()=>{e.addClass("ani"),this.move(l,e,s,o)}))},getDirection:(t,e)=>t>e&&t>10?"horizontal":e>t&&e>10?"vertical":"",resetTouchStatus(t,e){let s=e.state;s.direction="",s.deltaX=0,s.deltaY=0,s.offsetX=0,s.offsetY=0},stopTouchStart(t,e,s){let o=t.instance,a=s.state;this.resetTouchStatus(o,s);var i=t.touches[0];a.startX=i.clientX,a.startY=i.clientY},stopTouchMove(t,e){t.instance;let s=e.state,o=t.touches[0];s.deltaX=o.clientX-s.startX,s.deltaY=o.clientY-s.startY,s.offsetY=Math.abs(s.deltaY),s.offsetX=Math.abs(s.deltaX),s.direction=s.direction||this.getDirection(s.offsetX,s.offsetY)}},nt={mounted(t,e,s){this.state={}},methods:{showWatch(t,e,s,o){it.showWatch(t,e,s,o,this)},touchstart(t,e){it.touchstart(t,e,this)},touchmove(t,e){it.touchmove(t,e,this)},touchend(t,e){it.touchend(t,e,this)}}},lt=t=>{t.$renderjs||(t.$renderjs=[]),t.$renderjs.push("renderswipe"),t.mixins||(t.mixins=[]),t.mixins.push({beforeCreate(){this.renderswipe=this},mounted(){this.$ownerInstance=this.$gcd(this,!0)}}),t.mixins.push(nt)},rt={mixins:[B,{},{}],emits:["click","change"],props:{show:{type:String,default:"none"},disabled:{type:Boolean,default:!1},autoClose:{type:Boolean,default:!0},threshold:{type:Number,default:20},leftOptions:{type:Array,default:()=>[]},rightOptions:{type:Array,default:()=>[]}},unmounted(){this.__isUnmounted=!0,this.uninstall()},methods:{uninstall(){this.swipeaction&&this.swipeaction.children.forEach(((t,e)=>{t===this&&this.swipeaction.children.splice(e,1)}))},getSwipeAction(t="uniSwipeAction"){let e=this.$parent,s=e.$options.name;for(;s!==t;){if(e=e.$parent,!e)return!1;s=e.$options.name}return e}}};at(rt),lt(rt);const ut=Y(rt,[["render",function(f,m,g,y,v,b){const x=h,w=p;return t(),e(w,{class:"uni-swipe"},{default:s((()=>[o(w,{class:"uni-swipe_box","change:prop":f.wxsswipe.showWatch,prop:f.is_show,"data-threshold":g.threshold,"data-disabled":g.disabled,onTouchstart:f.wxsswipe.touchstart,onTouchmove:f.wxsswipe.touchmove,onTouchend:f.wxsswipe.touchend},{default:s((()=>[o(w,{class:"uni-swipe_button-group button-group--left"},{default:s((()=>[a(f.$slots,"left",{},(()=>[(t(!0),i(n,null,l(g.leftOptions,((a,i)=>(t(),e(w,{key:i,style:r({backgroundColor:a.style&&a.style.backgroundColor?a.style.backgroundColor:"#C7C6CD"}),class:"uni-swipe_button button-hock",onTouchstart:f.appTouchStart,onTouchend:t=>f.appTouchEnd(t,i,a,"left"),onClick:u((t=>f.onClickForPC(i,a,"left")),["stop"])},{default:s((()=>[o(x,{class:"uni-swipe_button-text",style:r({color:a.style&&a.style.color?a.style.color:"#FFFFFF",fontSize:a.style&&a.style.fontSize?a.style.fontSize:"16px"})},{default:s((()=>[c(d(a.text),1)])),_:2},1032,["style"])])),_:2},1032,["style","onTouchstart","onTouchend","onClick"])))),128))]),!0)])),_:3}),o(w,{class:"uni-swipe_text--center"},{default:s((()=>[a(f.$slots,"default",{},void 0,!0)])),_:3}),o(w,{class:"uni-swipe_button-group button-group--right"},{default:s((()=>[a(f.$slots,"right",{},(()=>[(t(!0),i(n,null,l(g.rightOptions,((a,i)=>(t(),e(w,{key:i,style:r({backgroundColor:a.style&&a.style.backgroundColor?a.style.backgroundColor:"#C7C6CD"}),class:"uni-swipe_button button-hock",onTouchstart:f.appTouchStart,onTouchend:t=>f.appTouchEnd(t,i,a,"right"),onClick:u((t=>f.onClickForPC(i,a,"right")),["stop"])},{default:s((()=>[o(x,{class:"uni-swipe_button-text",style:r({color:a.style&&a.style.color?a.style.color:"#FFFFFF",fontSize:a.style&&a.style.fontSize?a.style.fontSize:"16px"})},{default:s((()=>[c(d(a.text),1)])),_:2},1032,["style"])])),_:2},1032,["style","onTouchstart","onTouchend","onClick"])))),128))]),!0)])),_:3})])),_:3},8,["change:prop","prop","data-threshold","data-disabled","onTouchstart","onTouchmove","onTouchend"])])),_:3})}],["__scopeId","data-v-ae2d0852"]]);const ct=Y({name:"uniSwipeAction",data:()=>({}),created(){this.children=[]},methods:{resize(){},closeAll(){this.children.forEach((t=>{t.is_show="none"}))},closeOther(t){this.openItem&&this.openItem!==t&&(this.openItem.is_show="none"),this.openItem=t}}},[["render",function(o,i,n,l,r,u){const c=p;return t(),e(c,null,{default:s((()=>[a(o.$slots,"default")])),_:3})}]]);const dt=Y({name:"UniSection",emits:["click"],props:{type:{type:String,default:""},title:{type:String,required:!0,default:""},titleFontSize:{type:String,default:"14px"},titleColor:{type:String,default:"#333"},subTitle:{type:String,default:""},subTitleFontSize:{type:String,default:"12px"},subTitleColor:{type:String,default:"#999"},padding:{type:[Boolean,String],default:!1}},computed:{_padding(){return"string"==typeof this.padding?this.padding:this.padding?"10px":""}},watch:{title(t){uni.report&&""!==t&&uni.report("title",t)}},methods:{onClick(){this.$emit("click")}}},[["render",function(i,n,l,u,g,y){const v=p,b=h;return t(),e(v,{class:"uni-section"},{default:s((()=>[o(v,{class:"uni-section-header",onClick:y.onClick},{default:s((()=>[l.type?(t(),e(v,{key:0,class:f(["uni-section-header__decoration",l.type])},null,8,["class"])):a(i.$slots,"decoration",{key:1},void 0,!0),o(v,{class:"uni-section-header__content"},{default:s((()=>[o(b,{style:r({"font-size":l.titleFontSize,color:l.titleColor}),class:f(["uni-section__content-title",{distraction:!l.subTitle}])},{default:s((()=>[c(d(l.title),1)])),_:1},8,["style","class"]),l.subTitle?(t(),e(b,{key:0,style:r({"font-size":l.subTitleFontSize,color:l.subTitleColor}),class:"uni-section-header__content-sub"},{default:s((()=>[c(d(l.subTitle),1)])),_:1},8,["style"])):m("",!0)])),_:1}),o(v,{class:"uni-section-header__slot-right"},{default:s((()=>[a(i.$slots,"right",{},void 0,!0)])),_:3})])),_:3},8,["onClick"]),o(v,{class:"uni-section-content",style:r({padding:y._padding})},{default:s((()=>[a(i.$slots,"default",{},void 0,!0)])),_:3},8,["style"])])),_:3})}],["__scopeId","data-v-0a8818d5"]]),ht=Y({__name:"index",setup(a){let r=g();y("setAdd",(function(t){console.log(t);let e=f.value.findIndex((e=>e.desk==t.desk));f.value[e].undoneRecord=!0})),F((()=>{r?M({token:r}).then((t=>{console.log(t)})).catch((t=>{v({url:"/pages/login/login"})})):v({url:"/pages/login/login"})}));const h=b({startTime:"",endTime:""});q().hour()<12?(h.startTime=q().startOf("day").subtract(12,"hour").format("YYYY-MM-DD HH:mm:ss"),h.endTime=q().endOf("day").subtract(12,"hour").format("YYYY-MM-DD HH:mm:ss")):(h.startTime=q().startOf("day").add(12,"hour").format("YYYY-MM-DD HH:mm:ss"),h.endTime=q().endOf("day").add(12,"hour").format("YYYY-MM-DD HH:mm:ss"));const f=x([]);X((async()=>{let t=await $(h);f.value=t,at.value="",w()}));const Y=b([{text:"设置已完成",style:{backgroundColor:"#dd524d",fontSize:"14px"}}]),B=b({actualMoney:"",id:"",isFinish:!0}),E=["正常辣","微辣","特辣"],R=["","warning","error"],J=x(null),G=async()=>{await O(B),S({title:"设置成功",icon:"success",mask:!0});let t=await $(h);f.value=t,J.value.close()},K=x(null),L=x("1"),Q=x("1"),Z=x(""),tt=x(""),et=x(null),st=()=>{K.value.open();let t=q().format("HH:mm");Z.value=t+"-"+(f.value.length+1)+"号订单"},ot=async()=>{if(Z.value)try{let t=await V({orderName:Z.value,isPack:"2"==L.value,taste:Number(Q.value),isFinish:!1,totalMoney:0,actualMoney:0,desk:Number(tt.value)||""});K.value.close(),t&&(S({title:"创建成功,请添加菜品",icon:"none",mask:!0}),setTimeout((()=>{C({url:"/pages/orderDetail/index?id="+t})}),2e3))}catch(t){K.value.close()}else et.value._Focus()};W((async()=>{let t=await $(h);f.value=t}));const at=x(""),it=async()=>{let t=await $({id:at.value});f.value=t},nt=async()=>{k({title:"提示",content:"确定要设置所有订单已完成吗？",success:async({confirm:t,cancel:e})=>{t&&(await z(),S({title:"设置成功",icon:"success"}))}})};return(a,r)=>{const h=A(T("uni-easyinput"),D),g=A(T("uni-tag"),j),y=p,v=A(T("uni-swipe-action-item"),ut),b=A(T("uni-swipe-action"),ct),x=A(T("uni-section"),dt),w=A(T("uni-popup-dialog"),P),k=A(T("uni-popup"),I);return t(),i("div",{class:"mt-[20rpx]"},[_("div",{class:"px-[12px] mb-[12px]"},[o(h,{clearable:"",prefixIcon:"search",confirmType:"搜索",modelValue:at.value,"onUpdate:modelValue":r[0]||(r[0]=t=>at.value=t),onBlur:it,placeholder:"输入订单ID精准查询"},null,8,["modelValue"])]),o(b,null,{default:s((()=>[(t(!0),i(n,null,l(f.value,(a=>(t(),e(v,{key:a.id,"right-options":Y,onClick:t=>(async t=>{J.value.open(),B.id=t.id,B.isFinish=!0,B.actualMoney=t.actualMoney})(a),disabled:a.isFinish,class:"mb-2"},{default:s((()=>[o(y,{onClick:u((t=>((t,e)=>{C({url:"/pages/orderDetail/index?id="+t.id+"&name="+e})})(a,(t=>t.orderName+(t.desk?"-"+t.desk+"号桌":""))(a))),["stop"]),class:"flex shadow-lg py-[14rpx] px-[20rpx] items-center relative",style:{border:"2rpx solid #f5f5f5"}},{default:s((()=>[_("div",{class:"text-text2 text-14"},[_("p",null,d(a.orderName),1),_("p",{class:"text-12"},"创建时间："+d(a.showTime),1)]),_("div",{class:"ml-auto"},[a.taste&&1!=a.taste?(t(),e(g,{key:0,type:R[a.taste-1],style:{"margin-right":"4px"},text:E[a.taste-1],size:"small"},null,8,["type","text"])):m("",!0),a.isPack?(t(),e(g,{key:1,style:{"margin-right":"4px"},text:"打包",size:"small",type:"warning"})):m("",!0),a.desk?(t(),e(g,{key:2,style:{"margin-right":"4px"},text:a.desk+"号桌",size:"small",type:"primary"},null,8,["text"])):m("",!0),o(g,{text:a.isFinish?"已完成":"进行中",size:"small",type:a.isFinish?"":"primary"},null,8,["text","type"])]),a.undoneRecord?(t(),i("span",{key:0,class:"absolute top-0 rotate-45 text-12 text-text3 left-1/2 scale-75",style:{border:"1px solid red"}},"有加菜")):m("",!0)])),_:2},1032,["onClick"])])),_:2},1032,["right-options","onClick","disabled"])))),128))])),_:1}),0===f.value.length?(t(),e(H,{key:0})):m("",!0),_("div",{class:"px-[20rpx] mt-[20rpx] pb-[20px]"},[o(N,{icon:"plusempty",onClick:st},{default:s((()=>[c("新增订单")])),_:1}),o(N,{icon:"gear",class:"mt-[12px]",type:"primary",onClick:nt},{default:s((()=>[c("一键设置订单完成")])),_:1})]),o(k,{ref_key:"popup1",ref:J,type:"dialog"},{default:s((()=>[o(w,{duration:2e3,"before-close":!0,onClose:r[2]||(r[2]=t=>J.value.close()),onConfirm:G},{default:s((()=>[o(x,{title:"实收金额",type:"line",padding:""},{default:s((()=>[o(h,{errorMessage:"",modelValue:B.actualMoney,"onUpdate:modelValue":r[1]||(r[1]=t=>B.actualMoney=t),type:"number",focus:"",placeholder:"请输入收款金额"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},512),o(k,{ref_key:"popup2",ref:K,type:"dialog"},{default:s((()=>[o(w,{title:"添加订单",duration:2e3,"before-close":!0,onClose:r[7]||(r[7]=t=>K.value.close()),onConfirm:ot},{default:s((()=>[_("div",{class:"w-full"},[_("div",null,[o(h,{ref_key:"nameInput",ref:et,errorMessage:"",modelValue:Z.value,"onUpdate:modelValue":r[3]||(r[3]=t=>Z.value=t),type:"text",focus:"",placeholder:"请输入订单名称"},null,8,["modelValue"]),Z.value?m("",!0):(t(),i("p",{key:0,class:"text-text3 text-12"},"请输入订单名称"))]),_("div",{class:"flex justify-start mt-[10px]"},[o(U,{modelValue:L.value,"onUpdate:modelValue":r[4]||(r[4]=t=>L.value=t),list:[{label:"在这吃",value:"1"},{label:"打包",value:"2"}]},null,8,["modelValue"])]),_("div",{class:"flex justify-start mt-[8rpx]"},[o(U,{modelValue:Q.value,"onUpdate:modelValue":r[5]||(r[5]=t=>Q.value=t),list:[{label:"正常辣",value:"1"},{label:"微辣",value:"2"},{label:"特辣",value:"3"}]},null,8,["modelValue"])]),_("div",{class:"mt-[10px]"},[o(h,{modelValue:tt.value,"onUpdate:modelValue":r[6]||(r[6]=t=>tt.value=t),type:"number",placeholder:"请输入桌号(可不填)"},null,8,["modelValue"])])])])),_:1})])),_:1},512)])}}},[["__scopeId","data-v-7b202467"]]);export{ht as default};
