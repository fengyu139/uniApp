import{p as e,$ as a,a4 as l,o as u,b as t,a as i,w as s,J as o,a5 as m,D as n,f as r,a6 as p,A as d,a7 as c}from"./index-98ace898.js";import{_ as v}from"./uni-easyinput.78d3b24e.js";import{q as f,t as b,r as g,v as y}from"./api.7b4175c0.js";import{_ as V,a as _}from"./uni-forms.9310c91c.js";import{_ as h}from"./uni-file-picker.1f78cd47.js";import{s as j}from"./globalStore.f46f5287.js";import{A as k}from"./abRadio.400a98c5.js";import{_ as I}from"./abPicker.c8c34f7f.js";import{_ as w}from"./abButton.3c71e561.js";import"./uni-cloud.es.87a2abee.js";const F={__name:"addMenu",setup(F){const P=e({id:"",name:"",price:"",type:"1",picImg:"",isOnline:!0,unit:"串"});a("menuItem",(function(e){l({title:"修改菜单"}),P.value=e}));const U=e([]),x=e({tempFilePaths:[],tempFiles:[]}),M=e=>{console.log(e)},O=e=>{x.value=e},N=e(null),S=async()=>{await N.value.validate(),x.value.tempFilePaths.length&&await(async()=>new Promise(((e,a)=>{p({url:`${y.baseUrl}/upload`,fileType:"image",filePath:x.value.tempFilePaths[0],type:"menu",name:"image",success:({data:a,statusCode:l})=>{console.log(a),P.value.picImg=JSON.parse(a).data,e(JSON.parse(a))},fail:e=>{console.log(e),a(e)}})})))(),console.log(P.value.picImg);let e="";P.value.picImg&&(e=P.value.picImg.includes("http")?"":P.value.picImg);let a={...P.value,type:Number(P.value.type),price:Number(P.value.price),picImg:e};P.value.id?await f(a):await b(a),o("changeMenu",a),m({delta:1})},q={name:{rules:[{required:!0,errorMessage:"请填写商品名"}]},price:{rules:[{required:!0,errorMessage:"请填写价格"}]}};return(e,a)=>{const l=g(d("uni-easyinput"),v),o=g(d("uni-forms-item"),V),m=c,p=g(d("uni-file-picker"),h),f=g(d("uni-forms"),_);return u(),t("div",{class:"p-[10px]"},[i(f,{modelValue:P.value,ref_key:"menuForm",ref:N,rules:q},{default:s((()=>[i(o,{label:"商品:",name:"name"},{default:s((()=>[i(l,{type:"text",modelValue:P.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>P.value.name=e),placeholder:"请输入商品名"},null,8,["modelValue"])])),_:1}),i(o,{label:"价格:",name:"price"},{default:s((()=>[i(l,{type:"number",modelValue:P.value.price,"onUpdate:modelValue":a[1]||(a[1]=e=>P.value.price=e),placeholder:"请输入价格"},null,8,["modelValue"])])),_:1}),i(o,{label:"分类:",name:"unit"},{default:s((()=>[i(I,{modelValue:P.value.type,"onUpdate:modelValue":a[2]||(a[2]=e=>P.value.type=e),selectList:n(j)},null,8,["modelValue","selectList"])])),_:1}),i(o,{label:"单位:",name:"unit"},{default:s((()=>[i(k,{class:"mt-[8px]",modelValue:P.value.unit,"onUpdate:modelValue":a[3]||(a[3]=e=>P.value.unit=e),list:[{label:"串",value:"串"},{label:"份",value:"份"},{label:"瓶",value:"瓶"},{label:"件",value:"件"},{label:"个",value:"个"},{label:"斤",value:"斤"},{label:"条",value:"条"}]},null,8,["modelValue"])])),_:1}),i(o,{label:"上架:",name:"unit"},{default:s((()=>[i(m,{checked:P.value.isOnline,onChange:a[4]||(a[4]=e=>P.value.isOnline=e.detail.value)},null,8,["checked"])])),_:1}),i(o,{label:"预览图:",name:"unit"},{default:s((()=>[i(p,{modelValue:U.value,"onUpdate:modelValue":a[5]||(a[5]=e=>U.value=e),fileMediatype:"image",mode:"grid",limit:"1",onSelect:O,onFail:M,sizeType:"compressed"},null,8,["modelValue"])])),_:1})])),_:1},8,["modelValue"]),i(w,{onClick:S,icon:"plusempty"},{default:s((()=>[r("提 交")])),_:1})])}}};export{F as default};
