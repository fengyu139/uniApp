import{W as e,E as a,A as t,o as l,c as s,w as i,b as o,t as n,j as c,a as r,h as u,f as d,e as m,F as p,d as h,g as f,i as x,X as y,p as _,s as g,m as b,q as v,Y as D,Z as C,v as k,y as w,H as V}from"./index-98ace898.js";import{_ as N,r as S,i as Y,o as M,u as j,b as R,l as K,n as I,p as $}from"./api.7b4175c0.js";import{_ as q}from"./uni-easyinput.78d3b24e.js";import{_ as A,a as P}from"./uni-forms.9310c91c.js";import{_ as U}from"./uni-datetime-picker.e85c63e2.js";import{_ as B,a as E}from"./uni-popup.3ffff078.js";import{B as G}from"./uni-cloud.es.87a2abee.js";import{_ as T}from"./abButton.3c71e561.js";import{d as z}from"./dayjs.min.f5f076fe.js";const F=N({name:"uni-data-select",mixins:[G.mixinDatacom||{}],props:{localdata:{type:Array,default:()=>[]},value:{type:[String,Number],default:""},modelValue:{type:[String,Number],default:""},label:{type:String,default:""},placeholder:{type:String,default:"请选择"},emptyTips:{type:String,default:"无选项"},clear:{type:Boolean,default:!0},defItem:{type:Number,default:0},disabled:{type:Boolean,default:!1},format:{type:String,default:""}},data:()=>({showSelector:!1,current:"",mixinDatacomResData:[],apps:[],channels:[],cacheKey:"uni-data-select-lastSelectedValue"}),created(){this.debounceGet=this.debounce((()=>{this.query()}),300),this.collection&&!this.localdata.length&&this.debounceGet()},computed:{typePlaceholder(){const e=this.placeholder,a={"opendb-stat-app-versions":"版本","opendb-app-channels":"渠道","opendb-app-list":"应用"}[this.collection];return a?e+a:e},valueCom(){return this.modelValue}},watch:{localdata:{immediate:!0,handler(e,a){Array.isArray(e)&&a!==e&&(this.mixinDatacomResData=e)}},valueCom(e,a){this.initDefVal()},mixinDatacomResData:{immediate:!0,handler(e){e.length&&this.initDefVal()}}},methods:{debounce(e,a=100){let t=null;return function(...l){t&&clearTimeout(t),t=setTimeout((()=>{e.apply(this,l)}),a)}},query(){this.mixinDatacomEasyGet()},onMixinDatacomPropsChange(){this.collection&&this.debounceGet()},initDefVal(){let e="";if(!this.valueCom&&0!==this.valueCom||this.isDisabled(this.valueCom)){let a;if(this.collection&&(a=this.getCache()),a||0===a)e=a;else{let a="";this.defItem>0&&this.defItem<=this.mixinDatacomResData.length&&(a=this.mixinDatacomResData[this.defItem-1].value),e=a}(e||0===e)&&this.emit(e)}else e=this.valueCom;const a=this.mixinDatacomResData.find((a=>a.value===e));this.current=a?this.formatItemName(a):""},isDisabled(e){let a=!1;return this.mixinDatacomResData.forEach((t=>{t.value===e&&(a=t.disable)})),a},clearVal(){this.emit(""),this.collection&&this.removeCache()},change(e){e.disable||(this.showSelector=!1,this.current=this.formatItemName(e),this.emit(e.value))},emit(e){this.$emit("input",e),this.$emit("update:modelValue",e),this.$emit("change",e),this.collection&&this.setCache(e)},toggleSelector(){this.disabled||(this.showSelector=!this.showSelector)},formatItemName(e){let{text:a,value:t,channel_code:l}=e;if(l=l?`(${l})`:"",this.format){let a="";a=this.format;for(let t in e)a=a.replace(new RegExp(`{${t}}`,"g"),e[t]);return a}return this.collection.indexOf("app-list")>0?`${a}(${t})`:a||`未命名${l}`},getLoadData(){return this.mixinDatacomResData},getCurrentCacheKey(){return this.collection},getCache(a=this.getCurrentCacheKey()){return(e(this.cacheKey)||{})[a]},setCache(t,l=this.getCurrentCacheKey()){let s=e(this.cacheKey)||{};s[l]=t,a(this.cacheKey,s)},removeCache(t=this.getCurrentCacheKey()){let l=e(this.cacheKey)||{};delete l[t],a(this.cacheKey,l)}}},[["render",function(e,a,_,g,b,v){const D=f,C=S(t("uni-icons"),Y),k=x,w=y;return l(),s(D,{class:"uni-stat__select"},{default:i((()=>[_.label?(l(),o("span",{key:0,class:"uni-label-text hide-on-phone"},n(_.label+"："),1)):c("",!0),r(D,{class:u(["uni-stat-box",{"uni-stat__actived":b.current}])},{default:i((()=>[r(D,{class:u(["uni-select",{"uni-select--disabled":_.disabled}])},{default:i((()=>[r(D,{class:"uni-select__input-box",onClick:v.toggleSelector},{default:i((()=>[b.current?(l(),s(D,{key:0,class:"uni-select__input-text"},{default:i((()=>[d(n(b.current),1)])),_:1})):(l(),s(D,{key:1,class:"uni-select__input-text uni-select__input-placeholder"},{default:i((()=>[d(n(v.typePlaceholder),1)])),_:1})),b.current&&_.clear&&!_.disabled?(l(),s(D,{key:2,onClick:m(v.clearVal,["stop"])},{default:i((()=>[r(C,{type:"clear",color:"#c0c4cc",size:"24"})])),_:1},8,["onClick"])):(l(),s(D,{key:3},{default:i((()=>[r(C,{type:b.showSelector?"top":"bottom",size:"14",color:"#999"},null,8,["type"])])),_:1}))])),_:1},8,["onClick"]),b.showSelector?(l(),s(D,{key:0,class:"uni-select--mask",onClick:v.toggleSelector},null,8,["onClick"])):c("",!0),b.showSelector?(l(),s(D,{key:1,class:"uni-select__selector"},{default:i((()=>[r(D,{class:"uni-popper__arrow"}),r(w,{"scroll-y":"true",class:"uni-select__selector-scroll"},{default:i((()=>[0===b.mixinDatacomResData.length?(l(),s(D,{key:0,class:"uni-select__selector-empty"},{default:i((()=>[r(k,null,{default:i((()=>[d(n(_.emptyTips),1)])),_:1})])),_:1})):(l(!0),o(p,{key:1},h(b.mixinDatacomResData,((e,a)=>(l(),s(D,{class:"uni-select__selector-item",key:a,onClick:a=>v.change(e)},{default:i((()=>[r(k,{class:u({"uni-select__selector__disabled":e.disable})},{default:i((()=>[d(n(v.formatItemName(e)),1)])),_:2},1032,["class"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})):c("",!0)])),_:1},8,["class"])])),_:1},8,["class"])])),_:1})}],["__scopeId","data-v-2b70f49c"]]),H={__name:"mine",setup(a){const u=_({}),m=_("");M((async()=>{let a=await j();u.value=a,m.value=e("auth")})),R((async()=>{let e=await j();u.value=e,g()}));const p=()=>{D("token"),C({url:"/pages/login/login"})},h=_(null),x=_(null),y=b({userName:"",password:"",expireDate:z().format("YYYY-MM-DD")}),N=b({userName:"",expireDate:z().format("YYYY-MM-DD")}),G=_(null),H=_(z().subtract(1,"day").format("YYYY-MM-DD")),L=_(z().add(12,"month").format("YYYY-MM-DD")),O={userName:{rules:[{required:!0,errorMessage:"请填写用户名"}]},password:{rules:[{required:!0,errorMessage:"请填写密码"}]},expireDate:{rules:[{required:!0,errorMessage:"请选择有效期"}]}},W=()=>{G.value.validate().then((async e=>{try{await K(e);h.value.close(),k({title:"添加成功",icon:"success",mask:!0})}catch(a){h.value.close()}}))},X=_(null),Z=async()=>{let e=await I();ee.value=e,x.value.open()},J=()=>{N.expireDate=ee.value.find((e=>e.value==N.userName)).expireDate},Q=()=>{X.value.validate().then((async e=>{try{await $(e);x.value.close(),k({title:"修改成功",icon:"success",mask:!0})}catch(a){x.value.close()}}))},ee=_([]),ae=()=>{w({url:"/pages/article/article"})};return(e,a)=>{const _=V,g=f,b=S(t("uni-icons"),Y),D=S(t("uni-easyinput"),q),C=S(t("uni-forms-item"),A),k=S(t("uni-datetime-picker"),U),w=S(t("uni-forms"),P),M=S(t("uni-popup-dialog"),B),j=S(t("uni-popup"),E),R=S(t("uni-data-select"),F);return l(),s(g,{class:"p-[16px]"},{default:i((()=>[v("div",{class:"flex items-center shadow-md p-[6px] bg-bg1 rounded-md"},[r(_,{src:"/assets/user-9cefc664.png",class:"w-[50px] h-[50px]"}),r(g,{class:"ml-[12px]"},{default:i((()=>[v("p",null,[d(" 账号："),v("span",{class:"text-text3"},n(u.value.userName),1)]),v("p",null,[d(" 账号姓名："),v("span",{class:"text-text3"},n(u.value.realName),1)])])),_:1})]),v("ul",{class:"mt-[12px]"},[v("li",{class:"flex items-center shadow-md p-[12px] bg-bg1 rounded-md"},[r(_,{src:"/assets/order-light-1318cfbc.svg",class:"w-[20px] h-[20px]"}),v("span",{class:"ml-[2px]"}," 我添加的订单数量 "),v("span",{class:"ml-auto text-text3 text-16 font-bold"},n(u.value.orderCount),1)]),v("li",{class:"flex items-center shadow-md p-[12px] bg-bg1 rounded-md mt-[12px]"},[r(_,{src:"/assets/money-bag-outline-1cf1e9fb.svg",class:"w-[20px] h-[20px]"}),v("span",{class:"ml-[2px]"}," 我的订单总金额 "),v("span",{class:"ml-auto text-text3 text-16 font-bold"},n(u.value.totalMoney),1)]),v("li",{class:"flex items-center shadow-md p-[12px] bg-bg1 rounded-md mt-[12px]"},[r(_,{src:"/assets/hand-money-outline-f14960fa.svg",class:"w-[20px] h-[20px]"}),v("span",{class:"ml-[2px]"}," 我的订单总优惠 "),v("span",{class:"ml-auto text-text3 text-16 font-bold"},n(u.value.discountedMoney),1)]),"superAdmin"==m.value?(l(),o("li",{key:0,class:"flex items-center shadow-md p-[12px] bg-bg1 rounded-md mt-[12px]",onClick:ae},[r(_,{src:"/assets/article-line-635f8d8c.svg",class:"w-[20px] h-[20px]"}),v("span",{class:"ml-[2px]"}," 我的添加的文章 "),r(b,{class:"ml-auto",type:"arrowright",color:"",size:"20"})])):c("",!0),"superAdmin"==m.value?(l(),o("li",{key:1,class:"flex items-center shadow-md p-[12px] bg-bg1 rounded-md mt-[12px]"},[r(T,{type:"primary",icon:"plusempty",onClick:a[0]||(a[0]=e=>h.value.open())},{default:i((()=>[d("添加账户")])),_:1}),r(T,{type:"primary",icon:"compose",onClick:Z},{default:i((()=>[d("修改账户")])),_:1})])):c("",!0)]),v("div",{class:"mt-[60px]"},[r(T,{type:"default",icon:"undo",iconColor:"#000",onClick:p},{default:i((()=>[d("退出登录")])),_:1})]),r(j,{ref_key:"addPopup",ref:h,type:"dialog"},{default:i((()=>[r(M,{title:"添加账户","before-close":!0,onClose:a[4]||(a[4]=e=>h.value.close()),onConfirm:W},{default:i((()=>[r(w,{modelValue:y,ref_key:"addForm",ref:G,rules:O},{default:i((()=>[r(C,{label:"用户名:",name:"userName"},{default:i((()=>[r(D,{type:"text",modelValue:y.userName,"onUpdate:modelValue":a[1]||(a[1]=e=>y.userName=e),placeholder:"请输入用户名"},null,8,["modelValue"])])),_:1}),r(C,{label:"密码:",name:"password"},{default:i((()=>[r(D,{type:"text",modelValue:y.password,"onUpdate:modelValue":a[2]||(a[2]=e=>y.password=e),placeholder:"请输入密码"},null,8,["modelValue"])])),_:1}),r(C,{label:"有效期:",name:"expireDate"},{default:i((()=>[r(k,{modelValue:y.expireDate,"onUpdate:modelValue":a[3]||(a[3]=e=>y.expireDate=e),start:H.value,end:L.value,type:"date"},null,8,["modelValue","start","end"])])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},512),r(j,{ref_key:"editPopup",ref:x,type:"dialog"},{default:i((()=>[r(M,{title:"修改账户","before-close":!0,onClose:a[7]||(a[7]=e=>x.value.close()),onConfirm:Q},{default:i((()=>[r(w,{modelValue:N,ref_key:"editForm",ref:X,rules:O},{default:i((()=>[r(C,{label:"用户名:",name:"userName"},{default:i((()=>[r(R,{modelValue:N.userName,"onUpdate:modelValue":a[5]||(a[5]=e=>N.userName=e),localdata:ee.value,onChange:J},null,8,["modelValue","localdata"])])),_:1}),r(C,{label:"有效期:",name:"expireDate"},{default:i((()=>[r(k,{modelValue:N.expireDate,"onUpdate:modelValue":a[6]||(a[6]=e=>N.expireDate=e),start:H.value,end:L.value,type:"date"},null,8,["modelValue","start","end"])])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},512)])),_:1})}}};export{H as default};
