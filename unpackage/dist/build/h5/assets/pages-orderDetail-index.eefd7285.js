import{o as e,c as t,w as a,a as l,n as s,h as u,f as n,i,g as o,a3 as r,A as c,b as d,q as p,F as m,d as f,D as v,t as y,j as h,G as x,J as b,H as g,W as k,Z as _,Y as C,p as D,B as w,u as V,k as q,$ as N,ae as O,v as S,E as F,X as j,a4 as B,s as I,af as E}from"./index-e5e243ac.js";import{_ as L}from"./uni-easyinput.7a56ffff.js";import{_ as $,r as J,x as A,y as T,f as M,g as U,z,A as H,i as R,o as P,m as Y,c as G,b as W}from"./api.1c2959bd.js";import{a as X,_ as Z,b as K}from"./uni-popup.0c0bfa33.js";import{i as Q}from"./imgErr.8cf36142.js";import{_ as ee}from"./abEmpty.8487cdee.js";import{d as te}from"./dayjs.min.7fb22b02.js";import{_ as ae}from"./abMiniButton.790c16ac.js";import{_ as le}from"./addRecords.73f242b8.js";import{A as se}from"./abRadio.44b837e0.js";import{s as ue}from"./globalStore.7d8f3cbd.js";import"./uni-collapse.c9cef784.js";const ne=$({name:"UniNumberBox",emits:["change","input","update:modelValue","blur","focus"],props:{value:{type:[Number,String],default:1},modelValue:{type:[Number,String],default:1},min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1},background:{type:String,default:"#f5f5f5"},color:{type:String,default:"#333"},disabled:{type:Boolean,default:!1}},data:()=>({inputValue:0}),watch:{value(e){this.inputValue=+e},modelValue(e){this.inputValue=+e}},created(){1===this.value&&(this.inputValue=+this.modelValue),1===this.modelValue&&(this.inputValue=+this.value)},methods:{_calcValue(e){if(this.disabled)return;const t=this._getDecimalScale();let a=this.inputValue*t,l=this.step*t;if("minus"===e){if(a-=l,a<this.min*t)return;a>this.max*t&&(a=this.max*t)}if("plus"===e){if(a+=l,a>this.max*t)return;a<this.min*t&&(a=this.min*t)}this.inputValue=(a/t).toFixed(String(t).length-1),this.$emit("input",+this.inputValue),this.$emit("update:modelValue",+this.inputValue),this.$emit("change",+this.inputValue)},_getDecimalScale(){let e=1;return~~this.step!==this.step&&(e=Math.pow(10,String(this.step).split(".")[1].length)),e},_onBlur(e){this.$emit("blur",e);let t=e.detail.value;if(isNaN(t))return void(this.inputValue=this.min);t=+t,t>this.max?t=this.max:t<this.min&&(t=this.min);const a=this._getDecimalScale();this.inputValue=t.toFixed(String(a).length-1),this.$emit("input",+this.inputValue),this.$emit("update:modelValue",+this.inputValue),this.$emit("change",+this.inputValue)},_onFocus(e){this.$emit("focus",e)}}},[["render",function(c,d,p,m,f,v){const y=i,h=o,x=r;return e(),t(h,{class:"uni-numbox"},{default:a((()=>[l(h,{onClick:d[0]||(d[0]=e=>v._calcValue("minus")),class:"uni-numbox__minus uni-numbox-btns",style:s({background:p.background})},{default:a((()=>[l(y,{class:u(["uni-numbox--text",{"uni-numbox--disabled":f.inputValue<=p.min||p.disabled}]),style:s({color:p.color})},{default:a((()=>[n("-")])),_:1},8,["class","style"])])),_:1},8,["style"]),l(x,{disabled:p.disabled,onFocus:v._onFocus,onBlur:v._onBlur,class:"uni-numbox__value",type:"number",modelValue:f.inputValue,"onUpdate:modelValue":d[1]||(d[1]=e=>f.inputValue=e),style:s({background:p.background,color:p.color})},null,8,["disabled","onFocus","onBlur","modelValue","style"]),l(h,{onClick:d[2]||(d[2]=e=>v._calcValue("plus")),class:"uni-numbox__plus uni-numbox-btns",style:s({background:p.background})},{default:a((()=>[l(y,{class:u(["uni-numbox--text",{"uni-numbox--disabled":f.inputValue>=p.max||p.disabled}]),style:s({color:p.color})},{default:a((()=>[n("+")])),_:1},8,["class","style"])])),_:1},8,["style"])])),_:1})}],["__scopeId","data-v-2cc6f69d"]]),ie={__name:"abMenuList",props:{list:{type:Array,default:()=>[]},disabledBtn:{type:Boolean,default:!1}},setup:a=>(s,u)=>{const n=g,i=J(c("uni-number-box"),ne);return e(),d(m,null,[p("ul",{class:"w-full"},[(e(!0),d(m,null,f(a.list.filter((e=>e.isOnline)),((t,s)=>(e(),d("li",{key:s,class:"flex p-[8px] mb-[12px] w-full mx-[12px] items-center",style:{"border-bottom":"1px solid var(--border_c)"}},[l(n,{src:t.picImg||v(Q),onError:e=>(e=>{e.picImg=Q})(t),onClick:e=>{var a;(a=t.picImg).includes("imgErr")||x({urls:[a]})},class:"w-[60px] h-[60px]"},null,8,["src","onError","onClick"]),p("div",{class:"ml-[10px]"},[p("p",null,y(t.name),1),p("p",null,[p("span",{class:"text-text3"},y(t.price.toFixed(2)),1),p("span",{class:"text-text2 text-12"},"/"+y(t.unit),1)]),l(i,{modelValue:t.count,"onUpdate:modelValue":e=>t.count=e,min:0,onChange:u[0]||(u[0]=e=>{b("shake")}),disabled:a.disabledBtn},null,8,["modelValue","onUpdate:modelValue","disabled"])])])))),128))]),a.list.length?h("",!0):(e(),t(ee,{key:0,text:"暂无数据"}))],64)}},oe=$({__name:"orderBottom",props:{list:{type:Array,default:()=>[]},isChange:{type:Boolean,default:!1},queryData:{type:Object,default:()=>{}},allList:{type:Array,default:()=>[]},backupData:{type:Array,default:()=>[]}},emits:["clear","updateClone","initOrder","setCloneData"],setup(s,{emit:u}){const i=s,r=k("userOrderId");console.log(r),r&&A({id:r}).then((e=>{e?_({url:"/pages/orderDetail/orderInfo"}):C("userOrderId")}));const x=D(""),b=O("btnStutas"),g=O("socket"),B=w((()=>{let e=i.list.reduce(((e,t)=>e+t.price*t.count),0);return parseFloat(e.toFixed(2))})),I=w((()=>i.list.reduce(((e,t)=>e+t.count),0))),E=async()=>{if((null==window?void 0:window.Fingerprint2)&&!q()){let e=await pe();x.value=e}if(i.isChange){if(i.queryData.id){let e=[];i.list.forEach((t=>{const a=i.backupData.find((e=>e.id==t.id));if(t.count!=a.count){let l=JSON.parse(JSON.stringify(t));l.count=t.count-a.count,l.count>0&&e.push({id:l.id,count:l.count,price:l.price,name:l.name})}})),await M({id:i.queryData.id,orderDetail:i.list.map((e=>({id:e.id,count:e.count,price:e.price,name:e.name}))),totalMoney:B.value,totalCount:I.value,recordsList:e.length?e:"",isAdmin:!0}),u("setCloneData")}else{let e=te().format("HH:mm");console.log(x.value);let t=await U({orderName:e+"-"+i.queryData.desk+"号桌",isPack:!1,taste:Number(W.value),isFinish:!1,totalCount:I.value,totalMoney:B.value,orderDetail:i.list.filter((e=>e.count>0)),actualMoney:0,desk:Number(i.queryData.desk)||"",userOperation:!0,isRead:!1,deviceNo:x.value},!0);console.log(t),q()||(b.value=!0,g.emit("message",{desk:i.queryData.desk,type:"submitted",orderId:t.data})),i.queryData.id=t.data,t.orderFlag&&(F("orderId",t.data),F("userOrderId",t.data),_({url:"/pages/orderDetail/orderInfo"})),G.value.close()}u("updateClone"),S({icon:"success",title:"已提交"})}else S({title:"没有更改，无需提交",icon:"none"})},L=D(null),$=D([]),P=async()=>{let e=await z({orderId:i.queryData.id||"234wert"});$.value=e,L.value.open()};T((()=>{i.isChange&&V({title:"提示",content:"订单未保存，是否保存",success:async({confirm:e,cancel:t})=>!e||(await E(),!0)})}));const Y=()=>{V({title:"提示",content:"确定要清空所有选项吗",showCancel:!0,success:({confirm:e,cancel:t})=>{e&&(u("clear"),S({icon:"success"}))}})},G=D(null),W=D("1"),K=async()=>{E()};let Q=[];const ue=D(!1),ne=()=>{S({title:"已重置菜单，请选择您要添加的菜品",icon:"none",mask:!1}),Q=JSON.parse(JSON.stringify(i.allList)),b.value=!1,ue.value=!0,u("clear")},ie=async()=>{let e=i.list.filter((e=>e.count>0));await H({orderId:i.queryData.id,desk:i.queryData.desk,items:e,totalMoney:B.value,totalCount:I.value});let t="";e.forEach((e=>{t+=` ${e.name}  x ${e.count} \n`})),q()||g.emit("message",{msg:t,desk:i.queryData.desk,type:"addFoods",orderId:i.queryData.id}),V({title:"提示",content:"提交成功，等待上菜吧",confirmText:"知道了",showCancel:!1}),b.value=!0,ue.value=!1,u("initOrder")},oe=()=>{V({title:"提示",content:"是否放弃本次加菜",showCancel:!0,success:({confirm:e,cancel:t})=>{e&&(b.value=!0,ue.value=!1,u("updateClone",Q))}})},re=D(1),ce=async()=>{V({title:"设置桌号",content:re.value,editable:!0,placeholderText:"请输入桌号",showCancel:!0,success:async({confirm:e,cancel:t,content:a})=>{e&&(await M({id:i.queryData.id,desk:Number(a)}),S({title:"成功",icon:"success",mask:!0}))}})};g.on("message",(e=>{if(i.queryData.desk&&i.queryData.desk==e.desk){if("submitted"==e.type)return void V({title:"提示",content:"您的同桌已经提交了订单",showCancel:!1,confirmText:"知道了",success:()=>{u("initOrder")}});q()||V({title:"来自您同桌的加菜",content:e.msg,showCancel:!1,confirmText:"知道了",success:()=>{u("initOrder")}})}}));const de=()=>{console.log(dhDom),dhDom.classList.remove("shake-top"),setTimeout((()=>{dhDom.classList.add("shake-top")}),0)};N("shake",(e=>{de()}));const pe=()=>new Promise(((e,t)=>{Fingerprint2.get((function(t){const a=t.map((function(e,t){return 0===t?e.value.replace(/\bNetType\/\w+\b/,""):e.value})),l=Fingerprint2.x64hash128(a.join(""),31);e(l)}))}));return(u,i)=>{const r=J(c("uni-icons"),R),x=o,g=j,k=J(c("uni-popup"),X),_=J(c("uni-popup-dialog"),Z);return e(),d("div",null,[p("div",{class:"h-[40px] flex items-center px-[10px]"},[p("span",{class:"flex items-center text-text3 text-16 font-bold",onClick:de},[p("div",{ref:"dhDom",id:"dhDom"},[l(r,{type:"cart",color:"",size:"24",class:"mr-[2px]"})],512),n(" "+y(v(B).toFixed(2)),1)]),l(x,{class:"ml-auto mr-[10px]"},{default:a((()=>[l(ae,{type:"warn",onClick:Y,icon:"close"},{default:a((()=>[n("清空")])),_:1})])),_:1}),v(q)()?(e(),t(x,{key:0,class:"mr-[10px]"},{default:a((()=>[l(ae,{onClick:ce},{default:a((()=>[n("设置桌号")])),_:1})])),_:1})):h("",!0),l(x,{class:"mr-[10px]"},{default:a((()=>[l(ae,{onClick:P},{default:a((()=>[n("查看明细")])),_:1})])),_:1}),s.queryData.desk&&v(b)?(e(),t(x,{key:1,class:"mr-[10px]"},{default:a((()=>[l(ae,{onClick:ne},{default:a((()=>[n("我要加菜")])),_:1})])),_:1})):h("",!0),!v(b)&&ue.value?(e(),t(x,{key:2,class:"mr-[10px]"},{default:a((()=>[l(ae,{onClick:oe},{default:a((()=>[n("取消")])),_:1})])),_:1})):h("",!0),v(b)||!ue.value||s.list.every((e=>0==e.count))?h("",!0):(e(),t(x,{key:3,class:"mr-[10px]"},{default:a((()=>[l(ae,{type:"warn",icon:"plusempty",onClick:ie},{default:a((()=>[n("选好了")])),_:1})])),_:1})),s.queryData.id&&!s.queryData.desk?(e(),t(x,{key:4,class:""},{default:a((()=>[l(ae,{type:"warn",onClick:E},{default:a((()=>[n("提交")])),_:1})])),_:1})):h("",!0),s.queryData.id?h("",!0):(e(),t(x,{key:5,class:""},{default:a((()=>[l(ae,{type:"warn",onClick:i[0]||(i[0]=e=>G.value.open())},{default:a((()=>[n("提交")])),_:1})])),_:1}))]),l(k,{ref_key:"popupOne",ref:L,type:"bottom"},{default:a((()=>[l(x,{class:"bg-bg3 p-[12px]"},{default:a((()=>[p("div",{class:"flex justify-center items-center px-[10px]"},[p("span",{class:"text-16 font-bold text-text2 ml-auto"},"订单汇总"),l(r,{class:"ml-auto",type:"closeempty",onClick:i[1]||(i[1]=e=>L.value.close()),color:"#ccc",size:"24"})]),l(g,{"scroll-y":"true",style:{"max-height":"80vh"}},{default:a((()=>[s.list.length?(e(),d("div",{key:0},[p("ul",null,[p("li",{class:"grid grid-cols-4 text-center py-[4px] font-bold"},[p("span",null,"名称"),p("span",null,"单价"),p("span",null,"数量"),p("span",null,"小记")]),(e(!0),d(m,null,f(s.list,(t=>(e(),d("li",{key:t.id,class:"grid grid-cols-4 text-center py-[4px]",style:{"border-bottom":"1px solid var(--border_c)"}},[p("span",null,y(t.name),1),p("span",null,y(t.price.toFixed(2)),1),p("span",null,y(t.count),1),p("span",{class:"text-text3"},y((t.price*t.count).toFixed(2)),1)])))),128))]),p("div",{class:"mt-[12px] flex justify-center"},[p("span",{class:"text-text3 font-bold mr-[10px]"},"总数量:"+y(v(I)),1),p("span",{class:"text-text3 font-bold"},"总计:"+y(v(B)),1)])])):(e(),t(ee,{key:1,text:"暂无数据"})),$.value.length>1?(e(),t(le,{key:2,recordsList:$.value},null,8,["recordsList"])):h("",!0)])),_:1})])),_:1})])),_:1},512),l(k,{ref_key:"popupTwo",ref:G,type:"dialog"},{default:a((()=>[l(_,{title:"添加订单",duration:2e3,"before-close":!0,onClose:i[3]||(i[3]=e=>G.value.close()),onConfirm:K},{default:a((()=>[p("div",{class:"w-full"},[l(se,{modelValue:W.value,"onUpdate:modelValue":i[2]||(i[2]=e=>W.value=e),list:[{label:"正常辣",value:"1"},{label:"微辣",value:"2"},{label:"特辣",value:"3"}]},null,8,["modelValue"])])])),_:1})])),_:1},512)])}}},[["__scopeId","data-v-30897fe9"]]),re=$({__name:"index",setup(i){const o=D([]),r=D({}),x=D(""),b=D(1),g=D(0);let _=D([]);const C=D({});P((async e=>{C.value=e;let t="欢迎点餐";(e.name||e.desk)&&(t=e.name||e.desk+"号桌"),B({title:t}),O()}));const V=D(!1);E("btnStutas",V);const N=w((()=>{var e;return(null==(e=r.value)?void 0:e.isFinish)||C.value.desk&&V.value})),O=async()=>{let e=k("menuList");if(e&&q())o.value=e;else{let e=await Y({filter:!0});o.value=e,F("menuList",e)}o.value.forEach((e=>{e.count=0})),_.value=o.value.map((e=>e.count));let t={};if(C.value.id?t={id:C.value.id}:C.value.desk&&(t={desk:C.value.desk,isFinish:!1}),Object.keys(t).length){let e=await G(t,!0);if(!e.length)return;r.value=e[0],r.value.desk==C.value.desk&&(V.value=!0),C.value.id=r.value.id,o.value.forEach((e=>{e.count=0,r.value.orderDetail.forEach((t=>{e.id==t.id&&(e.count=t.count)}))})),_.value=o.value.map((e=>e.count)),$()}},S=D([]),$=()=>{S.value=JSON.parse(JSON.stringify(o.value))};W((async()=>{await O(),I()}));const A=w((()=>o.value.filter((e=>e.count)))),T=w((()=>JSON.stringify(_.value)!=JSON.stringify(o.value.map((e=>e.count))))),M=w((()=>{let e={};return ue.value.forEach((t=>{e[t.value]=o.value.filter((e=>e.type==t.value&&e.count)).reduce(((e,t)=>e+Number(t.count)),0)})),e})),U=()=>{o.value.forEach((e=>{e.count=0}))},z=e=>{console.log(e),e&&(o.value=e),_.value=o.value.map((e=>e.count))},H=()=>{R.value.open()},R=D(null);return(i,r)=>{const k=J(c("uni-easyinput"),L),_=J(c("uni-transition"),K),D=j,w=J(c("uni-popup"),X);return e(),d(m,null,[p("div",{class:"p-[12px]"},[l(k,{clearable:"",prefixIcon:"search",confirmType:"搜索",modelValue:x.value,"onUpdate:modelValue":r[0]||(r[0]=e=>x.value=e),onBlur:H,placeholder:"请输入关键字"},null,8,["modelValue"])]),p("div",{class:"flex",style:{height:"calc(100% - 98px)"}},[p("div",{class:"h-full bg-bg1 w-1/3"},[p("ul",{class:"text-text2"},[(e(!0),d(m,null,f(v(ue),((t,a)=>(e(),d("li",{class:u(["text-center py-[8px] my-[4px] relative",{active:t.value==b.value}]),key:a,onClick:e=>{b.value=t.value,g.value=a}},[n(y(t.text)+" ",1),t.value==b.value?(e(),d("div",{key:0,class:"absolute left-[4px] top-[8px]"},[l(_,{"mode-class":"slide-bottom",styles:{width:"4px",height:"20px",backgroundColor:"red"},show:t.value==b.value,onChange:i.change},null,8,["show","onChange"])])):h("",!0),v(M)[t.value]?(e(),d("span",{key:1,class:"bg-bg2 text-text4 rounded-md text-12 px-[6px] absolute top-0 right-[2px] scale-[80%]"},y(v(M)[t.value]),1)):h("",!0)],10,["onClick"])))),128))])]),p("div",{class:"h-full overflow-hidden w-2/3"},[p("div",{class:"h-full scrollDom",style:s({transform:`translateY(-${100*g.value}%)`})},[(e(!0),d(m,null,f(v(ue),(s=>(e(),t(D,{"scroll-y":"true",class:"h-full",key:s.value},{default:a((()=>[l(ie,{list:o.value.filter((e=>e.type==s.value)),disabledBtn:v(N)},null,8,["list","disabledBtn"])])),_:2},1024)))),128))],4)])]),l(oe,{list:v(A),allList:o.value,backupData:S.value,isChange:v(T),queryData:C.value,onClear:U,onUpdateClone:z,onInitOrder:O,onSetCloneData:$},null,8,["list","allList","backupData","isChange","queryData"]),l(w,{ref_key:"popupOne",ref:R,type:"bottom"},{default:a((()=>[p("div",{class:"p-[12px] bg-bg3"},[l(ie,{list:o.value.filter((e=>e.name.includes(x.value?x.value:"qwe12323sdss"))),disabledBtn:v(N)},null,8,["list","disabledBtn"])])])),_:1},512)],64)}}},[["__scopeId","data-v-a1b9a7a8"]]);export{re as default};
