import{W as e,E as a,A as t,o as l,c as s,w as i,b as o,t as n,j as u,a as c,h as r,f as d,e as m,F as p,d as h,g as f,i as x,X as y,p as _,s as b,m as g,q as v,Y as D,Z as C,v as k,H as w}from"./index-e2f60810.js";import{_ as V}from"./uni-easyinput.52acdbc9.js";import{_ as N,r as S,i as Y,o as M,u as j,b as R,l as K,n as I,p as $}from"./api.bd94d21b.js";import{_ as q,a as A}from"./uni-forms.cafc5c32.js";import{_ as P}from"./uni-datetime-picker.1996bbff.js";import{_ as U,a as B}from"./uni-popup.91bf8749.js";import{B as E}from"./uni-cloud.es.c24e6cc5.js";import{_ as G}from"./abButton.12c12e99.js";import{d as T}from"./dayjs.min.0950a910.js";const F=N({name:"uni-data-select",mixins:[E.mixinDatacom||{}],props:{localdata:{type:Array,default:()=>[]},value:{type:[String,Number],default:""},modelValue:{type:[String,Number],default:""},label:{type:String,default:""},placeholder:{type:String,default:"请选择"},emptyTips:{type:String,default:"无选项"},clear:{type:Boolean,default:!0},defItem:{type:Number,default:0},disabled:{type:Boolean,default:!1},format:{type:String,default:""}},data:()=>({showSelector:!1,current:"",mixinDatacomResData:[],apps:[],channels:[],cacheKey:"uni-data-select-lastSelectedValue"}),created(){this.debounceGet=this.debounce((()=>{this.query()}),300),this.collection&&!this.localdata.length&&this.debounceGet()},computed:{typePlaceholder(){const e=this.placeholder,a={"opendb-stat-app-versions":"版本","opendb-app-channels":"渠道","opendb-app-list":"应用"}[this.collection];return a?e+a:e},valueCom(){return this.modelValue}},watch:{localdata:{immediate:!0,handler(e,a){Array.isArray(e)&&a!==e&&(this.mixinDatacomResData=e)}},valueCom(e,a){this.initDefVal()},mixinDatacomResData:{immediate:!0,handler(e){e.length&&this.initDefVal()}}},methods:{debounce(e,a=100){let t=null;return function(...l){t&&clearTimeout(t),t=setTimeout((()=>{e.apply(this,l)}),a)}},query(){this.mixinDatacomEasyGet()},onMixinDatacomPropsChange(){this.collection&&this.debounceGet()},initDefVal(){let e="";if(!this.valueCom&&0!==this.valueCom||this.isDisabled(this.valueCom)){let a;if(this.collection&&(a=this.getCache()),a||0===a)e=a;else{let a="";this.defItem>0&&this.defItem<=this.mixinDatacomResData.length&&(a=this.mixinDatacomResData[this.defItem-1].value),e=a}(e||0===e)&&this.emit(e)}else e=this.valueCom;const a=this.mixinDatacomResData.find((a=>a.value===e));this.current=a?this.formatItemName(a):""},isDisabled(e){let a=!1;return this.mixinDatacomResData.forEach((t=>{t.value===e&&(a=t.disable)})),a},clearVal(){this.emit(""),this.collection&&this.removeCache()},change(e){e.disable||(this.showSelector=!1,this.current=this.formatItemName(e),this.emit(e.value))},emit(e){this.$emit("input",e),this.$emit("update:modelValue",e),this.$emit("change",e),this.collection&&this.setCache(e)},toggleSelector(){this.disabled||(this.showSelector=!this.showSelector)},formatItemName(e){let{text:a,value:t,channel_code:l}=e;if(l=l?`(${l})`:"",this.format){let a="";a=this.format;for(let t in e)a=a.replace(new RegExp(`{${t}}`,"g"),e[t]);return a}return this.collection.indexOf("app-list")>0?`${a}(${t})`:a||`未命名${l}`},getLoadData(){return this.mixinDatacomResData},getCurrentCacheKey(){return this.collection},getCache(a=this.getCurrentCacheKey()){return(e(this.cacheKey)||{})[a]},setCache(t,l=this.getCurrentCacheKey()){let s=e(this.cacheKey)||{};s[l]=t,a(this.cacheKey,s)},removeCache(t=this.getCurrentCacheKey()){let l=e(this.cacheKey)||{};delete l[t],a(this.cacheKey,l)}}},[["render",function(e,a,_,b,g,v){const D=f,C=S(t("uni-icons"),Y),k=x,w=y;return l(),s(D,{class:"uni-stat__select"},{default:i((()=>[_.label?(l(),o("span",{key:0,class:"uni-label-text hide-on-phone"},n(_.label+"："),1)):u("",!0),c(D,{class:r(["uni-stat-box",{"uni-stat__actived":g.current}])},{default:i((()=>[c(D,{class:r(["uni-select",{"uni-select--disabled":_.disabled}])},{default:i((()=>[c(D,{class:"uni-select__input-box",onClick:v.toggleSelector},{default:i((()=>[g.current?(l(),s(D,{key:0,class:"uni-select__input-text"},{default:i((()=>[d(n(g.current),1)])),_:1})):(l(),s(D,{key:1,class:"uni-select__input-text uni-select__input-placeholder"},{default:i((()=>[d(n(v.typePlaceholder),1)])),_:1})),g.current&&_.clear&&!_.disabled?(l(),s(D,{key:2,onClick:m(v.clearVal,["stop"])},{default:i((()=>[c(C,{type:"clear",color:"#c0c4cc",size:"24"})])),_:1},8,["onClick"])):(l(),s(D,{key:3},{default:i((()=>[c(C,{type:g.showSelector?"top":"bottom",size:"14",color:"#999"},null,8,["type"])])),_:1}))])),_:1},8,["onClick"]),g.showSelector?(l(),s(D,{key:0,class:"uni-select--mask",onClick:v.toggleSelector},null,8,["onClick"])):u("",!0),g.showSelector?(l(),s(D,{key:1,class:"uni-select__selector"},{default:i((()=>[c(D,{class:"uni-popper__arrow"}),c(w,{"scroll-y":"true",class:"uni-select__selector-scroll"},{default:i((()=>[0===g.mixinDatacomResData.length?(l(),s(D,{key:0,class:"uni-select__selector-empty"},{default:i((()=>[c(k,null,{default:i((()=>[d(n(_.emptyTips),1)])),_:1})])),_:1})):(l(!0),o(p,{key:1},h(g.mixinDatacomResData,((e,a)=>(l(),s(D,{class:"uni-select__selector-item",key:a,onClick:a=>v.change(e)},{default:i((()=>[c(k,{class:r({"uni-select__selector__disabled":e.disable})},{default:i((()=>[d(n(v.formatItemName(e)),1)])),_:2},1032,["class"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})):u("",!0)])),_:1},8,["class"])])),_:1},8,["class"])])),_:1})}],["__scopeId","data-v-2b70f49c"]]),z={__name:"mine",setup(a){const r=_({}),m=_("");M((async()=>{let a=await j();r.value=a,m.value=e("auth")})),R((async()=>{let e=await j();r.value=e,b()}));const p=()=>{D("token"),C({url:"/pages/login/login"})},h=_(null),x=_(null),y=g({userName:"",password:"",expireDate:T().format("YYYY-MM-DD")}),N=g({userName:"",expireDate:T().format("YYYY-MM-DD")}),Y=_(null),E=_(T().subtract(1,"day").format("YYYY-MM-DD")),z=_(T().add(12,"month").format("YYYY-MM-DD")),H={userName:{rules:[{required:!0,errorMessage:"请填写用户名"}]},password:{rules:[{required:!0,errorMessage:"请填写密码"}]},expireDate:{rules:[{required:!0,errorMessage:"请选择有效期"}]}},L=()=>{Y.value.validate().then((async e=>{try{await K(e);h.value.close(),k({title:"添加成功",icon:"success",mask:!0})}catch(a){h.value.close()}}))},O=_(null),W=async()=>{let e=await I();J.value=e,x.value.open()},X=()=>{N.expireDate=J.value.find((e=>e.value==N.userName)).expireDate},Z=()=>{O.value.validate().then((async e=>{try{await $(e);x.value.close(),k({title:"修改成功",icon:"success",mask:!0})}catch(a){x.value.close()}}))},J=_([]);return(e,a)=>{const _=w,b=f,g=S(t("uni-easyinput"),V),D=S(t("uni-forms-item"),q),C=S(t("uni-datetime-picker"),P),k=S(t("uni-forms"),A),M=S(t("uni-popup-dialog"),U),j=S(t("uni-popup"),B),R=S(t("uni-data-select"),F);return l(),s(b,{class:"p-[16px]"},{default:i((()=>[v("div",{class:"flex items-center shadow-md p-[6px] bg-bg1 rounded-md"},[c(_,{src:"/assets/user-9cefc664.png",class:"w-[50px] h-[50px]"}),c(b,{class:"ml-[12px]"},{default:i((()=>[v("p",null,[d(" 账号："),v("span",{class:"text-text3"},n(r.value.userName),1)]),v("p",null,[d(" 账号姓名："),v("span",{class:"text-text3"},n(r.value.realName),1)])])),_:1})]),v("ul",{class:"mt-[12px]"},[v("li",{class:"flex items-center shadow-md p-[12px] bg-bg1 rounded-md"},[c(_,{src:"/assets/order-light-1318cfbc.svg",class:"w-[20px] h-[20px]"}),v("span",{class:"ml-[2px]"}," 我添加的订单数量 "),v("span",{class:"ml-auto text-text3 text-16 font-bold"},n(r.value.orderCount),1)]),v("li",{class:"flex items-center shadow-md p-[12px] bg-bg1 rounded-md mt-[12px]"},[c(_,{src:"/assets/money-bag-outline-1cf1e9fb.svg",class:"w-[20px] h-[20px]"}),v("span",{class:"ml-[2px]"}," 我的订单总金额 "),v("span",{class:"ml-auto text-text3 text-16 font-bold"},n(r.value.totalMoney),1)]),v("li",{class:"flex items-center shadow-md p-[12px] bg-bg1 rounded-md mt-[12px]"},[c(_,{src:"/assets/hand-money-outline-f14960fa.svg",class:"w-[20px] h-[20px]"}),v("span",{class:"ml-[2px]"}," 我的订单总优惠 "),v("span",{class:"ml-auto text-text3 text-16 font-bold"},n(r.value.discountedMoney),1)]),"superAdmin"==m.value?(l(),o("li",{key:0,class:"flex items-center shadow-md p-[12px] bg-bg1 rounded-md mt-[12px]"},[c(G,{type:"primary",icon:"plusempty",onClick:a[0]||(a[0]=e=>h.value.open())},{default:i((()=>[d("添加账户")])),_:1}),c(G,{type:"primary",icon:"compose",onClick:W},{default:i((()=>[d("修改账户")])),_:1})])):u("",!0)]),v("div",{class:"mt-[60px]"},[c(G,{type:"default",icon:"undo",iconColor:"#000",onClick:p},{default:i((()=>[d("退出登录")])),_:1})]),c(j,{ref_key:"addPopup",ref:h,type:"dialog"},{default:i((()=>[c(M,{title:"添加账户","before-close":!0,onClose:a[4]||(a[4]=e=>h.value.close()),onConfirm:L},{default:i((()=>[c(k,{modelValue:y,ref_key:"addForm",ref:Y,rules:H},{default:i((()=>[c(D,{label:"用户名:",name:"userName"},{default:i((()=>[c(g,{type:"text",modelValue:y.userName,"onUpdate:modelValue":a[1]||(a[1]=e=>y.userName=e),placeholder:"请输入用户名"},null,8,["modelValue"])])),_:1}),c(D,{label:"密码:",name:"password"},{default:i((()=>[c(g,{type:"text",modelValue:y.password,"onUpdate:modelValue":a[2]||(a[2]=e=>y.password=e),placeholder:"请输入密码"},null,8,["modelValue"])])),_:1}),c(D,{label:"有效期:",name:"expireDate"},{default:i((()=>[c(C,{modelValue:y.expireDate,"onUpdate:modelValue":a[3]||(a[3]=e=>y.expireDate=e),start:E.value,end:z.value,type:"date"},null,8,["modelValue","start","end"])])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},512),c(j,{ref_key:"editPopup",ref:x,type:"dialog"},{default:i((()=>[c(M,{title:"修改账户","before-close":!0,onClose:a[7]||(a[7]=e=>x.value.close()),onConfirm:Z},{default:i((()=>[c(k,{modelValue:N,ref_key:"editForm",ref:O,rules:H},{default:i((()=>[c(D,{label:"用户名:",name:"userName"},{default:i((()=>[c(R,{modelValue:N.userName,"onUpdate:modelValue":a[5]||(a[5]=e=>N.userName=e),localdata:J.value,onChange:X},null,8,["modelValue","localdata"])])),_:1}),c(D,{label:"有效期:",name:"expireDate"},{default:i((()=>[c(C,{modelValue:N.expireDate,"onUpdate:modelValue":a[6]||(a[6]=e=>N.expireDate=e),start:E.value,end:z.value,type:"date"},null,8,["modelValue","start","end"])])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},512)])),_:1})}}};export{z as default};
