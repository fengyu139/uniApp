import{p as e,A as a,B as t,s,o as l,c as i,w as n,g as r,q as o,a as c,f as u,t as d,C as m,b as p,d as f,j as y,F as x,u as h,v as Y,D as v,y as M,z as _,i as k}from"./index-6fc68066.js";import{_ as g}from"./uni-datetime-picker.8696ef93.js";import{b,c as D,e as F,g as j,r as C,h as w}from"./api.b4337b42.js";import{_ as N}from"./uni-easyinput.6738de2a.js";import{a as V,_ as T}from"./adBell.f49f36cd.js";import{_ as z}from"./uni-card.f0684529.js";import{d as B}from"./dayjs.min.3212f77e.js";import{_ as H}from"./abMiniButton.c3a227d8.js";import{_ as I}from"./abEmpty.0b9f1343.js";const O={__name:"order",setup(O){const U=e([B().subtract(1,"day").format("YYYY-MM-DD"),B().format("YYYY-MM-DD")]),q=e(B().subtract(12,"month").format("YYYY-MM-DD")),A=e(B().format("YYYY-MM-DD")),E=e(""),P=e(""),R=e([]),S=async()=>{await G({orderName:E.value,searchMoney:P.value})},$=a((()=>({startTime:B(U.value[0]).startOf("day").format("YYYY-MM-DD HH:mm:ss"),endTime:B(U.value[1]).endOf("day").format("YYYY-MM-DD HH:mm:ss")}))),G=async e=>{let a=await D(e);R.value=a};t((async()=>{U.value[0]&&U.value[1]&&G($.value)}));const J=a((()=>R.value.reduce(((e,a)=>e+Number(a.totalMoney)),0).toFixed(2)));b((async()=>{U.value=[B().subtract(1,"day").format("YYYY-MM-DD"),B().format("YYYY-MM-DD")];try{await G($.value),s()}catch(e){s()}}));return(e,a)=>{const t=C(_("uni-datetime-picker"),g),s=r,b=C(_("uni-easyinput"),N),D=k,B=C(_("uni-icons"),w),O=C(_("uni-tag"),T),$=C(_("uni-card"),z);return l(),i(s,null,{default:n((()=>[o("div",{class:"p-[20rpx]"},[c(s,{class:"example-body"},{default:n((()=>[c(t,{modelValue:U.value,"onUpdate:modelValue":a[0]||(a[0]=e=>U.value=e),type:"daterange",start:q.value,end:A.value,rangeSeparator:"至"},null,8,["modelValue","start","end"])])),_:1}),c(s,{class:"mt-[10px] grid grid-flow-col gap-6"},{default:n((()=>[c(b,{type:"number",prefixIcon:"search",modelValue:P.value,"onUpdate:modelValue":a[1]||(a[1]=e=>P.value=e),placeholder:"请输入不低于的金额",onBlur:S},null,8,["modelValue"]),c(b,{type:"text",prefixIcon:"search",modelValue:E.value,"onUpdate:modelValue":a[2]||(a[2]=e=>E.value=e),confirmType:"search",placeholder:"请输入订单关键字",onBlur:S},null,8,["modelValue"])])),_:1})]),c(s,{class:"grid grid-cols-3 text-14 text-center"},{default:n((()=>[o("span",null,[u("总单数:"),o("span",{class:"text-text3"},d(R.value.length),1)]),o("span",{class:""},[u("总金额:"),o("span",{class:"text-text3"},d(m(J)),1)]),o("span",{class:""},[u("未完成订单:"),o("span",{class:"text-text3"},d(R.value.filter((e=>!e.isFinish)).length),1)])])),_:1}),c(s,{class:"grid grid-cols-2 text-14 text-center"},{default:n((()=>[o("span",{class:""},[u("已结算金额:"),o("span",{class:"text-text3"},d(R.value.filter((e=>e.isFinish)).reduce(((e,a)=>e+Number(a.totalMoney)),0).toFixed(2)),1)]),o("span",{class:""},[u("未结算金额:"),o("span",{class:"text-text3"},d(R.value.filter((e=>!e.isFinish)).reduce(((e,a)=>e+Number(a.totalMoney)),0).toFixed(2)),1)])])),_:1}),c(s,null,{default:n((()=>[(l(!0),p(x,null,f(R.value,(e=>(l(),i($,{title:e.orderName,"sub-title":e.showTime,extra:`金额：${e.totalMoney}`,key:e.id},{title:n((()=>[c(s,{class:"flex items-center justify-between pt-[10px] px-[10px]"},{default:n((()=>[c(s,null,{default:n((()=>[c(s,{class:"flex items-center"},{default:n((()=>[c(D,{class:"mt-[2px] mr-[4px]"},{default:n((()=>[u(d(e.orderName),1)])),_:2},1024),c(B,{onClick:a=>(e=>{h({title:"修改订单名",content:e.orderName,editable:!0,showCancel:!0,success:({confirm:a,cancel:t,content:s})=>{a&&F({id:e.id,orderName:s}).then((()=>{e.orderName=s,Y({icon:"success",mask:!0})}))}})})(e),type:"compose",color:"#007aff",size:"20"},null,8,["onClick"])])),_:2},1024),c(s,{class:"text-[#afaeae] text-12"},{default:n((()=>[u(d(e.showTime),1)])),_:2},1024)])),_:2},1024),c(s,{class:"ml-auto"},{default:n((()=>[u(" 金额:"),c(D,{class:"text-text3"},{default:n((()=>[u(d(e.totalMoney),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),actions:n((()=>[c(s,{class:"card-actions flex py-[6px] justify-around",style:{"border-top":"1px solid var(--border_c)"}},{default:n((()=>[c(H,{plain:"",onClick:a=>(e=>{v("orderId",e.id),M({url:"/pages/orderDetail/orderInfo"})})(e)},{default:n((()=>[u("详情")])),_:2},1032,["onClick"]),e.isFinish?y("",!0):(l(),i(H,{key:0,plain:"",onClick:a=>(e=>{M({url:"/pages/orderDetail/index?id="+e.id+"&name="+e.orderName})})(e)},{default:n((()=>[u("修改")])),_:2},1032,["onClick"])),c(H,{plain:"",type:"warn",icon:"trash",iconColor:"#fa2c19",onClick:a=>(async e=>{h({title:"提示",content:"是否删除",success:({confirm:a,cancel:t})=>{a&&j({id:e.id}).then((a=>{Y({title:"删除成功"}),R.value=R.value.filter((a=>a.id!=e.id))}))}})})(e)},{default:n((()=>[u("删除")])),_:2},1032,["onClick"]),e.isFinish?y("",!0):(l(),i(H,{key:1,plain:"",onClick:a=>(async e=>{h({title:"实收金额",content:e.totalMoney,editable:!0,placeholderText:"请输入实收金额",showCancel:!0,success:({confirm:a,cancel:t,content:s})=>{a&&F({id:e.id,actualMoney:s||0,isFinish:!0}).then((()=>{e.isFinish=!0,e.actualMoney=s||0,Y({title:"成功",icon:"success",mask:!0})})).catch((()=>{Y({title:"失败"})}))}})})(e)},{default:n((()=>[u("设为已完成")])),_:2},1032,["onClick"]))])),_:2},1024)])),default:n((()=>[e.isRead||e.isFinish?y("",!0):(l(),i(V,{key:0})),c(O,{text:e.isFinish?"已完成":"未完成",size:"normal",type:e.isFinish?"success":"error"},null,8,["text","type"]),e.isPack?(l(),i(O,{key:1,style:{"margin-left":"4px"},text:"打包",size:"normal",type:"primary"})):y("",!0),e.desk?(l(),i(O,{key:2,style:{"margin-left":"4px"},text:e.desk+"号桌",size:"normal"},null,8,["text"])):y("",!0),e.userOperation?(l(),i(O,{key:3,style:{"margin-left":"4px"},type:"primary",text:"自助下单"})):y("",!0),e.actualMoney&&e.isFinish?(l(),i(O,{key:4,style:{"margin-left":"4px"},type:"primary",text:"实收:"+e.actualMoney},null,8,["text"])):y("",!0)])),_:2},1032,["title","sub-title","extra"])))),128)),0===R.value.length?(l(),i(I,{key:0,text:"暂无数据"})):y("",!0)])),_:1})])),_:1})}}};export{O as default};
